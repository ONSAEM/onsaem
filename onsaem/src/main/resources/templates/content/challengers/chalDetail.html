<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">


<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap"
	rel="stylesheet">


<!-- Css  -->
<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/bootstrap.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/font-awesome.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/elegant-icons.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/nice-select.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/shop/css/jquery-ui.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/owl.carousel.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/slicknav.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/style.css}"
		type="text/css">
</th:block>
<head>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	  
	<style type="text/css">
	button {
	   cursor: pointer;
	}
	
	.btn {
	   margin-top: 60px;
	}
	
	.modal {
	   display: flex;
	   justify-content: center;
	   align-items: center;
	   position: fixed;
	   top: 0;
	   left: 0;
	   width: 100%;
	   height: 100%;
	}
	
	.modal__background {
	   background-color: rgba(0, 0, 0, 0.6);
	   width: 100%;
	   height: 100%;
	   position: absolute;
	}
	
	.modal__content {
	   text-align: center;
	   position: relative;
	   background-color: white;
	   border-radius: 10px;
	   top: 0;
	   padding: 10px 25px;
	   width: 20%;
	}
	
	h1 {
	   margin: 0;
	   margin-bottom: 13px;
	}
	
	.hidden {
	   display: none;
	}
	</style>

  
</head>

<div layout:fragment="content">
<br>


    <!-- Breadcrumb Section Begin -->
    <section class="breadcrumb-section set-bg" th:data-setbg="@{/shoptemplate/img/breadcrumb.jpg}">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="breadcrumb__text">
                        <h2>Challengers</h2>
                        <div class="breadcrumb__option">
                            <a href="./index.html">Home</a>
                            <a href="./index.html">Vegetables</a>
                            <span>Vegetableâ€™s Package</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->

    <!-- Product Details Section Begin -->
    <section class="product-details spad">
        <div class="container"  th:each="chal : ${chals}">
            <div class="row">
                <div class="col-lg-6 col-md-6" >
                    <div class="product__details__pic">
                        <div class="product__details__pic__item">
                            <img class="product__details__pic__item--large"
                                th:src="'/fileView/'+${thumbnail.fileRoute}" style="width:500px;height:500px;">
                        </div>
                        
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="product__details__text">
                        <h3 th:text="${chal.chalName}">Vetgetableâ€™s Package</h3>
                        
                        <div class="product__details__price"><span th:text="'ê¸°ë¶€ì²˜ : ' + ${chal.ngoName}">$50.00</span></div>
                        	<ul>
                        	<input type="hidden" id="chalId" th:value="${chal.chalId}">
                            <li><b>ì‹œì‘ì¼</b> <span th:text="${#dates.format(chal.startDate, 'yyyyë…„ MMì›” ddì¼')}" ></span></li>
                            <li><b>ì¢…ë£Œì¼</b> <span th:text="${#dates.format(chal.endDate, 'yyyyë…„ MMì›” ddì¼')}"> <samp>Free pickup today</samp></span></li>
                            <li><b>ìœ í˜•</b> <span id="subClass" th:text="${chal.subClass}"></span></li>
                            <li th:if="${chal.subClass} == 'íŒ€'"><b>ê³ ì • ê¸°ë¶€ê¸ˆ</b> <span id="teamFee" th:text="${chal.teamFee}+'ì›'"></span></li>
                            <li th:if="${chal.subClass} == 'íŒ€'"><b>ë‚´ê¸° í¬ì¸íŠ¸</b> <span id="betPoint" th:text="${chal.teamFee}+'ì›'"></span></li>
                            <li><b>ì°¸ê°€ ìš”ì¼</b> <span th:text="${chal.frequency}"></span></li>
                       		</ul>
							
							
							<span th:if="${cnt.cnt} >=1" class="primary-btn" >ì´ë¯¸ ì°¸ê°€ ì¤‘ì¸ ì±Œë¦°ì§€ ì…ë‹ˆë‹¤</span>
							<button th:unless="${cnt.cnt} >=1" onclick = "goPage()" class="primary-btn">ì°¸ê°€í•˜ê¸°</button>
							
							<button class="openBtn" style="background-color:red; color:white; width:120px; height:51px; border:none">ì‹ ê³ í•˜ê¸°</button>						 	
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="product__details__tab">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#tabs-1" role="tab"
                                    aria-selected="true">ìƒì„¸ë³´ê¸°</a>
                            </li>
                            <li class="nav-item"><a class="nav-link" data-toggle="tab"
								href="#tabs-2" role="tab" aria-selected="false">í ëƒ</a>
							</li>
                        </ul>
                        <div class="tab-content">
                        	<div class="tab-pane active" id="tabs-1" role="tabpanel">
                                <div class="product__details__tab__desc">
                                    <h6>í™˜ê¸‰ ì•ˆë‚´</h6>
                                    <p>100% ì„±ê³µ : ì˜ˆì¹˜ê¸ˆ ì „ì•¡ ê¸°ë¶€ + ì˜ˆì¹˜ê¸ˆì˜ 1% í¬ì¸íŠ¸ ì ë¦½</p>
                                    <p>85% ì´ìƒ ì„±ê³µ : ì˜ˆì¹˜ê¸ˆ ì „ì•¡ ê¸°ë¶€ + ì˜ˆì¹˜ê¸ˆ 0.5% í¬ì¸íŠ¸ ì ë¦½</p>
                                    <p>85% ë¯¸ë§Œ ì„±ê³µ : ì˜ˆì¹˜ê¸ˆ ì „ì•¡ ê¸°ë¶€</p>
                                    <img src="/challengers/chart.png">
                                </div>
                                  
                                <div class="product__details__tab__desc">
                                    <h6>ì±Œë¦°ì§€ ì†Œê°œ</h6>
                                    <p th:text="${chal.contents}">ì±Œë¦°ì§€ ì†Œê°œ</p>
                                </div>
                                
                                <div class="product__details__tab__desc">
                                    <h6>ì¸ì¦ìƒ· ì˜ˆì‹œ</h6>
                                    <img th:src="'/fileView/'+${proofEx.fileRoute}" class="rounded float-start" style="width:300px;height:300px;">
                                    <p th:text="${chal.proofContent}">ì¸ì¦ ìƒ· ì˜ˆì‹œ</p>
                                </div>
                                
                                <div class="product__details__tab__desc">
                                    <h6>ë™ì˜ì‚¬í•­ ìš”ê±´</h6>
                                    	<p>ì±Œë¦°ì§€ì— ì°¸ê°€í•˜ì‹œê¸° ì „ì— ë™ì˜ì‚¬í•­ì— ì²´í¬í•´ ì£¼ì„¸ìš”</p>
                                     	<label><input type="checkbox" name="check" class="checkList">ëª¨ë“  ì˜ˆì¹˜ê¸ˆì€ ì„±ì·¨í¼ì„¼íŠ¸ì™€ ê´€ê³„ ì—†ì´ 100% ê¸°ë¶€ë©ë‹ˆë‹¤.</label><br>
                                     	<label><input type="checkbox" name="check" class="checkList">ì°¸ê°€í•˜ì…¨ì„ ì‹œì— ë“±ë¡í•˜ì‹  ì¸ì¦ ì‚¬ì§„ì€ ëª¨ë“  ìœ ì €ê°€ ì¡°íšŒ ê°€ëŠ¥ í•©ë‹ˆë‹¤.</label><br>
                                     	<label><input type="checkbox" name="check" class="checkList">ì±Œë¦°ì§€ ì°¸ê°€ ì·¨ì†ŒëŠ” ë§ˆì´í˜ì´ì§€ì—ì„œ ê°€ëŠ¥í•˜ë©°, ì‹œì‘ì¼ í•˜ë£¨ ì „ ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</label><br>
                               			<th:block th:if="${chal.subClass} == 'íŒ€'">
                               				<label><input type="checkbox"  name="check" class="checkList">ê³ ì • ê¸°ë¶€ê¸ˆì˜ 1%ì— í•´ë‹¹í•˜ëŠ” í¬ì¸íŠ¸ë¥¼ ë°°íŒ…í•´ì•¼ í•©ë‹ˆë‹¤.</label>
                               			</th:block>
                                </div>
                                <!-- íŒ€ì „ ì°¸ê°€ì‹œ í¬ì¸íŠ¸ ì—†ìœ¼ë©´ ì°¸ê°€ ë¶ˆê°€ ìœ„í•´ì„œ  -->
                                <input type="hidden" id="userPoint" th:value="${user.point}">                              
							</div>
							
							<!-- tab2 -->
							<div class="tab-pane" id="tabs-2" role="tabpanel">                        	
	 							
	 							<div th:if = "${receipt != null}">
	 								<img th:src="'/fileView/'+${receipt.fileRoute}">
	 							</div>                       	
							  <div class="row row-cols-3">
							    <div class="col" th:each="proof:${proofs}">
							    	<img th:src="'/fileView/'+${proof.fileRoute}">
							  	</div>
							</div>
                    	</div>
                    	<!--  tab2ë -->
                        </div>
                        
                        
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Product Details Section End -->
		<!-- ëª¨ë‹¬ì°½ -->
                  <div class="modal hidden">
                     <div class="modal__background"></div>
                     <div class="modal__content">

                        <h3>ì‹ ê³ í•˜ê¸°</h3>
                     
                        <p th:text="'ì±Œë¦°ì§€ ëª… : '+${chals.chalName}"></p>
                        <div class="modalText">
                           <textarea id="detailReason" name="detailReason"></textarea>
                           <button type="button" th:onclick="inputReport()">ì‹ ê³ í•˜ê¸°</button>
                           <button type="button" class="closeBtn">ë‹«ê¸°</button>
                        </div>
                     
                     </div>
                  </div>
                  <!-- ëª¨ë‹¬ì°½ ë›-->
    <!-- Related Product Section Begin -->
    <section class="related-product">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title related__product__title">
                        <h2>ì‹œì‘ ì„ë°• ì±Œë¦°ì§€</h2>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 col-md-4 col-sm-6" th:each="dday :${ddays}">
                    <div class="product__item">
                        <div class="product__item__pic set-bg" th:data-setbg="'/fileView/'+${dday.fileRoute}">
                            
                        </div>
                        <div class="product__item__text">
                            <h6><a th:text="${dday.chalName}" th:href="@{/detailChal(chalId = ${dday.chalId})}">Crab Pool Security</a></h6>
                            <h5 th:text="${dday.dday} + 'ì¼ í›„ ì‹œì‘'">$30.00</h5>
                        </div>
                    </div>
                </div>
            </div>
            
        
        </div>

          
        <!-- JS -->
		<th:block layout:fragment="script">
			<script th:src="@{/shoptemplate/js/jquery-3.3.1.min.js}"></script>
			<script th:src="@{/shoptemplate/js/bootstrap.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery.nice-select.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery-ui.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery.slicknav.js}"></script>
			<script th:src="@{/shoptemplate/js/mixitup.min.js}"></script>
			<script th:src="@{/shoptemplate/js/owl.carousel.min.js}"></script>
			<script th:src="@{/shoptemplate/js/main.js}"></script>
		</th:block>
		
		<script type="text/javascript">
		//ë‚´ê¸° í¬ì¸íŠ¸ ê³„ì‚°í›„ ë„£ì–´ì£¼ê¸°
		$('#betPoint').text(parseInt($('#teamFee').text())*0.01+'ì›');
		
    	//ì‹ ê³  ëª¨ë‹¬ì°½
		 const openButton = document.querySelector(".openBtn");
				const modal = document.querySelector(".modal");
				const closeButton = modal.querySelector(".closeBtn");
				const modalBackground = modal.querySelector(".modal__background");

				function displayModal(){
				    modal.classList.toggle("hidden");
				}

				openButton.addEventListener("click", displayModal);
				closeButton.addEventListener("click", displayModal)
				modalBackground.addEventListener("click", displayModal);
		
				
			//CHECK	í–ˆëŠ”ì§€ í™•ì¸í•˜ê¸°
			function goPage(e){
			 	console.log(e);
			 	if($('input[class=checkList]:checked').length<3){
			 		alert("ëª¨ë“  ë™ì˜ì‚¬í•­ì— ì²´í¬í•´ ì£¼ì„¸ìš”");
			 		return;
			 	}else if($('input[class=checkList]:checked').length>=3){
			 		 let data = $('#chalId').val();
			 		 console.log(data);
			 		if($('#subClass').text() == 'ê°œì¸'){
			 			location.href ="/applyChalFrm?chalId="+ data;
			 		}else{
			 			let userPoint = parseInt($('#userPoint').val());
			 			let teamFee = parseInt($('#teamFee').text()); 
			 			console.log(teamFee);
			 			console.log(userPoint);
			 			if(userPoint < teamFee*0.01){
			 				alert("ë‚´ê¸° í¬ì¸íŠ¸ê°€ ì¶©ë¶„í•˜ì§€ ì•Šì•„ ì°¸ê°€ê°€ ë¶ˆê°€í•©ë‹ˆë‹¤ğŸ˜¢");
			 			}else{
			 				 location.href = "/applyChalTeamFrm?chalId="+ data; 
			 				alert("êµ¿");
			 			}
			 		}
			 	}
    		}
			
		  //ì‹ ê³ ë³´ë‚´ê¸°
		      function inputReport(){

				  let groupId= "[[${chals.chalId}]]";
		          let toId="[[${chals.memberId}]]";
     			  let detailReason = document.getElementById("detailReason").value;
		          console.log(detailReason);
		          let reason = "ë¶ˆëŸ‰ì±Œë¦°ì§€";

 
		           $.ajax({
		              url:'/inputReport',
		              method: 'post',
		              contentType : 'application/json',
		              data: JSON.stringify({groupId:groupId,
		                 toId:toId,
		                 detailReason:detailReason,
		                 reason:reason}),
		              success : function(result){
		                 console.log(result);
		                 alert('ì‹ ê³  ì ‘ìˆ˜ ì™„ë£Œ');
		                 location.href="http://localhost/detailChal?chalId="+groupId;
		              },
		              error : function(error){
		                 console.log(error);
		              }
		           })  
		       }
    	
		</script>	
    </section>
    <!-- Related Product Section End -->
    
    
</div>
</html>