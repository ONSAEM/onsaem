<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">


<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap"
	rel="stylesheet">


<!-- Css  -->
<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/bootstrap.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/font-awesome.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/elegant-icons.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/nice-select.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/shop/css/jquery-ui.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/owl.carousel.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/slicknav.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/style.css}"
		type="text/css">
</th:block>
<head>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	  
	<style type="text/css">
	/*헤더  */
	/* ONE */
		.p1 li {
			font-size: 14px;
			width: 40px;
			height: 40px;
			line-height: 40px;
			padding: 0;
			text-align: center;
			float: left;
			cursor: pointer;
		}
		
		.main {
			flex-grow: 1;
			display: flex;
			flex-direction: column;
			min-width: 1400px;
		}
		
		.main-container {
			padding: 20px;
			flex-grow: 1;
			overflow: auto;
			background-color: #FCFBFC;
		}
		
		.profile-cover {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			object-fit: cover;
			object-position: center;
			border-radius: 4px;
		}
		
		.subheader {
			position: relative;
			height: 300px;
			min-height: 250px;
			z-index: 1;
			display: flex;
			justify-content: center;
			align-items: center;
			background-size: cover;
			background-position: center;
		}
		
		.subheader:before {
			content: "";
			width: 100%;
			height: 100%;
			position: absolute;
			z-index: -1;
			left: 0;
			top: 0;
			background-image: url("/course/chal.gif");
			background-repeat: no-repeat;
			background-size: cover;
			background-position: center;
			filter: blur(30px);
			opacity: 0.7;
		}
		
		.glass {
			height: 100%;
			width: 100%;
			background-image: url("/course/chal.gif");
			background-size: cover;
			background-position: center;
			clip-path: inset(10em);
			filter: blur(5px);
			display: flex;
			justify-content: center;
			align-items: center;
		}
		
		.drop-shadow {
			height: 155%;
			width: 100%;
			filter: drop-shadow(0px 20px 10px rgba(0, 0, 0, 0.3));
			display: flex;
			justify-content: center;
			align-items: center;
		}
		
		.drop-shadow:before {
			display: block;
			content: "";
			position: absolute;
			top: 10em;
			height: calc(100% - 20em);
			width: calc(100% - 20em);
			border-top: 2px solid rgba(225, 225, 225, 0.2);
			border-left: 1px solid rgba(225, 225, 225, 0.1);
			border-right: 1px solid rgba(225, 225, 225, 0.3);
			z-index: 2;
		}
		
		.drop-shadow>span {
			position: absolute;
			z-index: 5;
			color: white;
			font-size: 4em;
			letter-spacing: 0.75em;
			padding-left: 0.375em;
		}
		
		.sidebar {
			padding: 20px 30px;
			background-color: #ffffff;
			border-radius: 10px;
			margin-bottom: 10px;
		}
		
		.col-lg-9 {
			background-color: #ffffff;
			padding: 20px 30px;
			border-radius: 20px;
			margin-bottom: 10px;
		}
		
		.product {
			padding-top: 0px;
			padding-bottom: 80px;
			position: relative;
			z-index: 1;
		}
	button {
	   cursor: pointer;
	}
	
	.btn {
	   margin-top: 60px;
	}
	
	.modal {
	   display: flex;
	   justify-content: center;
	   align-items: center;
	   position: fixed;
	   top: 0;
	   left: 0;
	   width: 100%;
	   height: 100%;
	}
	
	.modal__background {
	   background-color: rgba(0, 0, 0, 0.6);
	   width: 100%;
	   height: 100%;
	   position: absolute;
	}
	
	.modal__content {
	   text-align: center;
	   position: relative;
	   background-color: white;
	   border-radius: 10px;
	   top: 0;
	   padding: 10px 25px;
	   width: 20%;
	}
	
	h1 {
	   margin: 0;
	   margin-bottom: 13px;
	}
	
	.hidden {
	   display: none;
	}
	#detailReason{
		width: 100%;
		background-color : #F9F9F2;
			height: 200px;
			padding: 10px;
			box-sizing: border-box;
			border: none;
			border-radius: 5px;
			font-size: 16px;
			resize: both;
	}
	.modalBtns{
		border-radius : 5px;
		width : 85px;
		height : 40px;
		background-color:#9dc2c0;
		border : none;
		color : white;
		font-weight : bold;
			
	}
	.modalBtns:hover{
		background-color:#DBC8E8;
		color : #717275;
		font-weight : bold;
	}
	
	/*상세화면 css  */
	#chalInfo{
		background-color:#f6f8f9;
		border : none;
		border-radius : 19px;
		margin : 5px;
		padding : 20px;
		width: 500px;
		
	}
	.liStyle{
		font-size : 20px;
	}
	.separate{
		margin : 20px;
	}
	.detailMenuTitle{
		font-size : 35px;
	}
	.pointRule{
		font-size : 20px;
	}
	.detailContent{
		background-color : #F5F5ED;
		width : 95%;
		margin : 0 auto;
		padding : 30px;
		border-radius : 20px
	}
	input[type=checkbox] {
		
		zoom: 2;
		
	}
	.detailBtn{
		padding : 20px 10px;
		width : 400px;
		height : 100px;
		border-radius : 15px;
		margin : 30px 0;
	}
	.btnTextStyle{
		font-size : 25px;
		font-weight:bold;
		color : white;
		margin: 0px
	}
	</style>

  
</head>

<div layout:fragment="content">
<br>


    <!-- Breadcrumb Section Begin -->
    <div class="subheader">
		<img src="/course/chal.gif" alt="" class="profile-cover">
		<div class="drop-shadow">
			<div class="glass"></div>
			<span>Challengers</span>
		</div>
	</div>
			<br>
    <!-- Breadcrumb Section End -->

    <!-- Product Details Section Begin -->
    <section class="product-details spad">
        <div class="container"  th:each="chal : ${chals}">
            <div class="row">
                <div class="col-lg-6 col-md-6" >
                    <div class="product__details__pic">
                        <div class="product__details__pic__item">
                            <img class="product__details__pic__item--large"
                                th:src="'/fileView/'+${thumbnail.fileRoute}" style="width:500px;height:500px;">
                        </div>
                        
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="product__details__text">
                        <h3 th:text="${chal.chalName}">Vetgetable’s Package
                        	<button class="openBtn" style="background-color:red; color:white; width:120px; height:51px; border:none" sec:authorize="isAuthenticated()">신고하기</button>	
							<button  style="background-color:red; color:white; width:120px; height:51px; border:none" sec:authorize="isAnonymous()"  onclick="noLogin()">신고하기</button>	
                        	
                        </h3>

                        <div class="product__details__price"><span th:text="'기부처 : ' + ${chal.ngoName}">$50.00</span></div>
                        	<ul id="chalInfo">
	                        	<input type="hidden" id="chalId" th:value="${chal.chalId}">
	                            <li><b class="liStyle">시작일</b> <span th:text="${#dates.format(chal.startDate, 'yyyy년 MM월 dd일')}" ></span></li>
	                            <li><b class="liStyle">종료일</b> <span th:text="${#dates.format(chal.endDate, 'yyyy년 MM월 dd일')}"> <samp>Free pickup today</samp></span></li>
	                            <li><b class="liStyle">유형</b> <span id="subClass" th:text="${chal.subClass}"></span></li>
	                            <li th:if="${chal.subClass} == '팀'"><b class="liStyle">고정 기부금</b> <span id="teamFee"  th:text="|${#numbers.formatInteger(chal.teamFee, 0, 'COMMA')}원|"></span></li>
	                            <li th:if="${chal.subClass} == '팀'"><b class="liStyle">내기 포인트</b> <span id="betPoint" th:text="${chal.teamFee}+'원'"></span></li>
	                            <li><b class="liStyle">참가 요일</b> <span th:text="${chal.frequency}"></span></li>
                       		</ul>
							
											 	
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="product__details__tab">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#tabs-1" role="tab"
                                    aria-selected="true">상세보기</a>
                            </li>
                            <li class="nav-item" th:if="${receipt} !=null ">
                            <a class="nav-link" data-toggle="tab" href="#tabs-2" role="tab" aria-selected="false">영수증</a>
							</li>
                        </ul>
                        <div class="tab-content">
                        	<div class="tab-pane active" id="tabs-1" role="tabpanel">
                                <div class="product__details__tab__desc" style="width: 100%; display:inline-block; padding : 30px 0;">
                                    <h6 class="detailMenuTitle">환급 안내</h6>
                                    <div class="detailContent">
	                                    <p class = "pointRule">✔  100% 성공 : 예치금 전액 기부 + 예치금의 1% 포인트 적립</p>
	                                    <p class = "pointRule">✔  85% 이상 성공 : 예치금 전액 기부 + 예치금 0.5% 포인트 적립</p>
	                                    <p class = "pointRule">✔  85% 미만 성공 : 예치금 전액 기부</p>
                                    </div>
                                    <img src="/challengers/chart.png">
                                </div>
                                  
                                <div class="product__details__tab__desc" style="width: 100%; display:inline-block; padding : 30px 0">
                                    <h6 class="detailMenuTitle">챌린지 소개</h6>
                                    <div class="detailContent">
	                                    <p th:text="${chal.contents}" class = "pointRule">챌린지 소개</p>
	                                    <div th:if="${detailPic} != null" style="text-align:center">
	                                    	<img  th:src="'/fileView/'+${detailPic.fileRoute}"}>
                                    </div>
                                    </div>
                                </div>
                                
                                <div class="product__details__tab__desc" style="width: 100%; display:inline-block; padding : 30px 0">
                                    <h6 class="detailMenuTitle">인증샷 예시</h6>
                                    <img th:src="'/fileView/'+${proofEx.fileRoute}" class="rounded float-start" style="width:300px;height:300px;">
                                    <p th:text="${chal.proofContent}">인증 샷 예시</p>
                                </div>
                                <br>
                                <div class="product__details__tab__desc" style="width: 100%; display:inline-block; padding : 30px 0 ">
                                    <h6 class="detailMenuTitle" style="color : #E07070">동의사항 요건</h6>
                                    	<p style="font-weight:bold; font-size : 25px; font-family: Georgia">📌 챌린지에 참가하시기 전에 동의사항에 체크해 주세요 ❗❗</p>
                                    	<div class="detailContent">
	                                     	<label class = "pointRule"><input type="checkbox" name="check" class="checkList"> 모든 예치금은 성취퍼센트와 관계 없이 100% 기부됩니다.</label><br>
	                                     	<label class = "pointRule"><input type="checkbox" name="check" class="checkList"> 참가하셨을 시에 등록하신 인증 사진은 모든 유저가 조회 가능 합니다.</label><br>
	                                     	<label class = "pointRule"><input type="checkbox" name="check" class="checkList"> 챌린지 참가 취소는 마이페이지에서 가능하며, 시작일 하루 전 까지 가능합니다.</label><br>
	                               			<th:block th:if="${chal.subClass} == '팀'">
	                               				<label class = "pointRule"><input type="checkbox"  name="check" class="checkList"> 고정 기부금의 1%에 해당하는 포인트를 배팅해야 합니다.</label>
	                               				<br>
	                               				<label class = "pointRule"><input type="checkbox"  name="check" class="checkList"> 배팅 포인트 만큼의 포인트가 없으실 경우 참가하실 수 없습니다.</label>
	                               			</th:block>
                               			</div>
                                </div>
                                <div style="text-align : center">
	                                <div th:if="${cnt}!=0 and ${cnt}!= null">
										<button th:if="${cnt.cnt} >0 and ${chal.nowStart} >=0 and ${chal.nowEnd}<0" class="primary-btn detailBtn " >
											<p class="btnTextStyle">이미 참가 중 입니다<p>
										<button th:if="${cnt.cnt} >=0 and ${cnt}!= null and ${chal.nowStart}<0 and ${chal.nowEnd}<0" onclick = "goPage()" class="primary-btn detailBtn">
											<p class="btnTextStyle">참가하기</p>
										</button>	
										</button>
										<button th:if="${cnt.cnt} >=0 and ${chal.nowStart}<0 and ${chal.nowEnd}<0" onclick = "goPage()" class="primary-btn detailBtn">
											<p class="btnTextStyle">참가하기</p>
										</button>
									</div>
									<button th:if = "${chal.nowEnd} >0 " class="primary-btn detailBtn" style="background-color : #E4C4C2 ">
										<p class="btnTextStyle">종료된 챌린지 입니다.<p>
									</button>
									<button th:if = "${chal.nowStart} >=0 and ${chal.nowEnd} <=0" class="primary-btn detailBtn" style="background-color : #E4C4C2 ">
										<p class="btnTextStyle">이미 시작된 챌린지 입니다<p>
									</button>
									
									<button th:if="${cnt}== null and ${chal.nowStart}<0 and ${chal.nowEnd}<0" onclick = "goPage()" class="primary-btn detailBtn">
											<p class="btnTextStyle">참가를 원하시면 로그인을 해주세요</p>
									</button>		
									
								</div>
							
                                
							
                                <!-- 팀전 참가시 포인트 없으면 참가 불가 위해서  -->
                                <div th:if="${user}!=null">
                                <input type="hidden" id="userPoint" th:value="${user.point}">
                                </div>                              
							</div>
							
							<!-- tab2 -->
							<div class="tab-pane" id="tabs-2" role="tabpanel">                        	
	 							
	 							<div th:if = "${receipt != null}" style="text-align : center">
	 								<img th:src="'/fileView/'+${receipt.fileRoute}" >
	 							</div>                       	
							  <div class="row row-cols-3">
							    <div class="col" th:each="proof:${proofs}">
							    	<img th:src="'/fileView/'+${proof.fileRoute}">
							  	</div>
							</div>
                    	</div>
                    	<!--  tab2끝 -->
                        </div>
                        
                        
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Product Details Section End -->
		<!-- 모달창 -->
                  <div class="modal hidden">
                     <div class="modal__background"></div>
                     <div class="modal__content">

                        <h3 style="color:#717275">신고하기</h3>
                     
                        <p th:text="'챌린지 명 : '+${chals.chalName}"></p>
                        <div class="modalText">
                           <textarea id="detailReason" name="detailReason"></textarea><br>
                           <button type="button" th:onclick="inputReport()" class="modalBtns">신고하기</button>
                           <button type="button" class="closeBtn modalBtns">닫기</button>
                        </div>
                     
                     </div>
                  </div>
                  <!-- 모달창 끛-->
    <!-- Related Product Section Begin -->
    <section class="related-product">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title related__product__title">
                        <h2>시작 임박 챌린지</h2>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 col-md-4 col-sm-6" th:each="dday :${ddays}">
                    <div class="product__item">
                        <div class="product__item__pic set-bg" th:data-setbg="'/fileView/'+${dday.fileRoute}">
                            
                        </div>
                        <div class="product__item__text">
                            <h6><a th:text="${dday.chalName}" th:href="@{/detailChal(chalId = ${dday.chalId})}">Crab Pool Security</a></h6>
                            <h5 th:text="${dday.dday} + '일 후 시작'">$30.00</h5>
                        </div>
                    </div>
                </div>
            </div>
            
        
        </div>

          
        <!-- JS -->
		<th:block layout:fragment="script">
			<script th:src="@{/shoptemplate/js/jquery-3.3.1.min.js}"></script>
			<script th:src="@{/shoptemplate/js/bootstrap.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery.nice-select.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery-ui.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery.slicknav.js}"></script>
			<script th:src="@{/shoptemplate/js/mixitup.min.js}"></script>
			<script th:src="@{/shoptemplate/js/owl.carousel.min.js}"></script>
			<script th:src="@{/shoptemplate/js/main.js}"></script>
		</th:block>
		
		<script type="text/javascript">
		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");
		
		//내기 포인트 계산후 넣어주기
		$('#betPoint').text(parseInt($('#teamFee').text())*0.01+'원');
		
    	//신고 모달창
		 const openButton = document.querySelector(".openBtn");
				const modal = document.querySelector(".modal");
				const closeButton = modal.querySelector(".closeBtn");
				const modalBackground = modal.querySelector(".modal__background");

				function displayModal(){
				    modal.classList.toggle("hidden");
				}

				openButton.addEventListener("click", displayModal);
				closeButton.addEventListener("click", displayModal)
				modalBackground.addEventListener("click", displayModal);
		
				
			//CHECK	했는지 확인하기
			function goPage(e){
			 	if($('input[class=checkList]:checked').length<3){
			 		alert("모든 동의사항에 체크해 주세요");
			 		return;
			 	}else if($('input[class=checkList]:checked').length>=3){
			 		 let data = $('#chalId').val();
			 		if($('#subClass').text() == '개인'){
			 			location.href ="/applyChalFrm?chalId="+ data;
			 		}else{
			 			let userPoint = parseInt($('#userPoint').val());
			 			let teamFee = parseInt($('#teamFee').text()); 
			 			if(userPoint < teamFee*0.01){
			 				alert("내기 포인트가 충분하지 않아 참가가 불가합니다😢");
			 			}else{
			 				 location.href = "/applyChalTeamFrm?chalId="+ data; 
			 				alert("굿");
			 			}
			 		}
			 	}
    		}
			
		  //신고보내기
		      function inputReport(){

				  let groupId= "[[${chals.chalId}]]";
		          let toId="[[${chals.memberId}]]";
     			  let detailReason = document.getElementById("detailReason").value;
		          let reason = "불량챌린지";

 
		           $.ajax({
		              url:'/inputReport',
		              method: 'post',
		              contentType : 'application/json',
		              beforeSend : function(xhr)
		               {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
		              	 xhr.setRequestHeader(header, token);
		               },
		              data: JSON.stringify({groupId:groupId,
		                 toId:toId,
		                 detailReason:detailReason,
		                 reason:reason}),
		              success : function(result){
		                 alert('신고 접수 완료');
		                 location.href="/detailChal?chalId="+groupId;
		              },
		              error : function(error){
		                 console.log(error);
		              }
		           })  
		       }
		  
		      function noLogin(){
					alert("로그인 후 이용가능합니다!")
				}
    	
		</script>	
    </section>
    <!-- Related Product Section End -->
    
    
</div>
</html>