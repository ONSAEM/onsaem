<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<!-- Css  -->
<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/bootstrap.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/font-awesome.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/elegant-icons.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/nice-select.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/shop/css/jquery-ui.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/owl.carousel.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/slicknav.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/style.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/css/member.css}" type="text/css">
</th:block>

<head>
<meta charset="UTF-8">
<style>
	.btnbtn{
		background-color : #5bc1ac;
		width: 200px;
		height : 40px;
		margin: 0 auto;
		border : none;
		border-radius : 3px;
		color : white;
		padding : 20px, 30px;
	}
	#btns{
		margin : 0, auto;
		text-align : center;
	}
	/* ONE */
	.p1 li {
		font-size: 14px;
		width: 40px;
		height: 40px;
		line-height: 40px;
		padding: 0;
		text-align: center;
		float: left;
		cursor: pointer;
	}
	
	.main {
		flex-grow: 1;
		display: flex;
		flex-direction: column;
		min-width: 1400px;
	}
	
	.main-container {
		padding: 20px;
		flex-grow: 1;
		overflow: auto;
		background-color: #FCFBFC;
	}
	
	.profile-cover {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		object-fit: cover;
		object-position: center;
		border-radius: 4px;
	}
	
	.subheader {
		position: relative;
		height: 300px;
		min-height: 250px;
		z-index: 1;
		display: flex;
		justify-content: center;
		align-items: center;
		background-size: cover;
		background-position: center;
	}
	
	.subheader:before {
		content: "";
		width: 100%;
		height: 100%;
		position: absolute;
		z-index: -1;
		left: 0;
		top: 0;
		background-image: url("/course/chal.gif");
		background-repeat: no-repeat;
		background-size: cover;
		background-position: center;
		filter: blur(30px);
		opacity: 0.7;
	}
	
	.glass {
		height: 100%;
		width: 100%;
		background-image: url("/course/chal.gif");
		background-size: cover;
		background-position: center;
		clip-path: inset(10em);
		filter: blur(5px);
		display: flex;
		justify-content: center;
		align-items: center;
	}
	
	.drop-shadow {
		height: 155%;
		width: 100%;
		filter: drop-shadow(0px 20px 10px rgba(0, 0, 0, 0.3));
		display: flex;
		justify-content: center;
		align-items: center;
	}
	
	.drop-shadow:before {
		display: block;
		content: "";
		position: absolute;
		top: 10em;
		height: calc(100% - 20em);
		width: calc(100% - 20em);
		border-top: 2px solid rgba(225, 225, 225, 0.2);
		border-left: 1px solid rgba(225, 225, 225, 0.1);
		border-right: 1px solid rgba(225, 225, 225, 0.3);
		z-index: 2;
	}
	
	.drop-shadow>span {
		position: absolute;
		z-index: 5;
		color: white;
		font-size: 4em;
		letter-spacing: 0.75em;
		padding-left: 0.375em;
	}
</style>
</head>

<body>
	<div layout:fragment="content">

		<!-- Breadcrumb Section Begin -->
		<div class="subheader">
			<img src="/course/chal.gif" alt="" class="profile-cover">
			<div class="drop-shadow">
				<div class="glass"></div>
				<span>Challengers</span>
		</div>
	</div>
		<!-- Breadcrumb Section End -->
		<br>
		<div class="wrapper">
			<div class="title">ì±Œë¦°ì €ìŠ¤ íŒ€ì „ ë“±ë¡</div>
			<form action="/inputTeamChal" method="post" enctype="multipart/form-data" name="inputFrm" class="form">
				<input type="hidden" id="token" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/> 
				<p>ì±Œë¦°ì§€ë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”!</p>
				<div class="inputfield">
					<label for="chalName" id="chalName">ì±Œë¦°ì§€ ì œëª©<span class="request">*</span></label>
					<input type="text"  id="chalName" name="chalName" class="input">
				</div>
				<div class="inputfield">
					<label>ì°¸ê°€ ì¸ì›</label>
					<input type="number"  id="usercnt" name="usercnt" class="input" 
						placeholder="ë³¸ì¸ í¬í•¨ ì§ìˆ˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”. ìµœëŒ€ì¸ì›ì€ 20ëª… ì…ë‹ˆë‹¤" onchange="checkCnt()">
				</div>
				<div class="inputfield">
					<label for="frequency" id="frequency">ì¸ì¦ ë¹ˆë„</label><br>
	            	<input name="frequency" type="radio" value="ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼">ë§¤ì¼
					<input name="frequency" type="radio" value="ì›”í™”ìˆ˜ëª©ê¸ˆ">í‰ì¼ ë§¤ì¼
					<input name="frequency" type="radio" value="í† ì¼">ì£¼ë§ ë§¤ì¼
					<input name="frequency" type="radio" value="" id="singleDay">ìš”ì¼ ì„ íƒ
					<select id="frequency">
						<option value="">==ìš”ì¼ì„ íƒ==</option>
						<option value="ì›”" >ì›”ìš”ì¼</option>
						<option value="í™”">í™”ìš”ì¼</option>
						<option value="ìˆ˜">ìˆ˜ìš”ì¼</option>
						<option value="ëª©">ëª©ìš”ì¼</option>
						<option value="ê¸ˆ">ê¸ˆìš”ì¼</option>
						<option value="í† ">í† ìš”ì¼</option>
						<option value="ì¼">ì¼ìš”ì¼</option>	
					</select>
				</div>
				<p style="margin : 5px 0">ğŸ“¢ ì±Œë¦°ì§€ ë¦¬ë”ë‹˜ì´ ì„¤ì •í•˜ì‹œëŠ” ê¸ˆì•¡ì€ ëª¨ë“  íŒ€ì›ì—ê²Œ ì ìš© ë©ë‹ˆë‹¤!</p>
		        <p style="margin : 5px 0">ğŸ“¢ ë‚´ê¸° í¬ì¸íŠ¸ëŠ” ì„¤ì •í•˜ì‹œëŠ” ê¸°ë¶€ê¸ˆì•¡ì˜ 1%ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤!</p>
				<div class="inputfield">
		        	<label for="teamFee">ê¸°ë¶€ê¸ˆ</label>
		        	<input id="value" value=5000 onchange="changePoint(this.value)" class="input"  name="teamFee"></input>
		        	<br>
		       		
				</div>
				<div class="inputfield">
		        	<label>í¬ì¸íŠ¸</label><input name="betPoint" type="number" id="betPoint"  class="input" readonly>
		       		
				</div>
				<div class="inputfield">
					<label for="ngoName">ê¸°ë¶€ì²˜</label>
			        <select name="ngoName">
			        	<option value="">==ê¸°ë¶€ì²˜ ì„ íƒ==</option>
			        	<option th:each="ngo : ${ngoes}" th:value="${ngo.ngoName}"
			                th:text="${ngo.ngoName}"></option>        	
			        </select>
				</div>
				<div class="inputfield">
					 <label for="startDate">ì‹œì‘ì¼</label>
	        		<input name="startDate" type="date" onchange="checkStart()" class="input">
				</div>
				<div class="inputfield">
					<label for= "endDate">ì¢…ë£Œì¼</label>
	        		<input name="endDate" type="date" onchange="checkDate()" class="input">
				</div>

				<div class="inputfield">
					<label for="proofEx">ì¸ì¦ìƒ· ì˜ˆì‹œ</label>
	        		<input type="file" id ="proofEx" name="uploadFile" class="input">
				</div>
				<div class="inputfield">
					<label for="contents">ì¸ì¦ ë°©ë²• ì†Œê°œ<span class="request">*</span></label>
	        		<textarea rows="5" cols="20" 
	        		placeholder="ì˜ˆ)ì´ë ‡ê²Œ ì¸ì¦ìƒ·ì„ ë‚¨ê²¨ì£¼ì„¸ìš”:)" id="proofContent"
	        		 value="contents" name="proofContent" class="input"></textarea>	
				</div>
				<div class="inputfield">
					<label for="contents">ì±Œë¦°ì§€ ì†Œê°œ<span class="request">*</span></label>
	        		<textarea rows="5" cols="20" 
	        		placeholder="ì˜ˆ)ì´ë ‡ê²Œ ì¸ì¦ìƒ·ì„ ë‚¨ê²¨ì£¼ì„¸ìš”:)" id="proofContent"
	        		 value="contents" name="proofContent" class="input"></textarea>	
				</div>
								
				<div class="inputfield">
					<label for="contents">ì±Œë¦°ì§€ ì†Œê°œ</label>
	        		<textarea rows="5" cols="20" 
	        		placeholder="ì˜ˆ) ë§¤ì¼ 1ë§Œë³´ ê±·ê³  ê±´ê°•í•´ì§€ê¸°! ì˜¤ëŠ˜ë¶€í„° ê°™ì´ í•´ë´ìš” :)" id="contents"
	        		 value="contents" name="contents" class="input"></textarea>	
				</div>
				<div class="inputfield">
					 <label for="detailPic">ìƒì„¸ ì„¤ëª… ì‚¬ì§„ ì²¨ë¶€<span class="request">*</span></label>
	        		<input type="file" id ="thumbnail" name="uploadFile" >
				</div>
				<div class="inputfield">
					 <label for="proofEx">ì¸ë„¤ì¼ ì²¨ë¶€<span class="request">*</span></label>
	        		<input type="file" id ="thumbnail" name="uploadFile" >
				</div>
				
				<input type="hidden" name="paymentId">
				<input type="hidden" name="paymentMethod">
				<div id="btns">
					<input type="button" id="paymentBtn" value="ë“±ë¡í•˜ê¸°" class="btnbtn">
					<input type="reset" value="ì·¨ì†Œ" class="btnbtn" onClick="history.go(-1)">
				</div>
			</form>
		</div>
			<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
		
		<script type="text/javascript">
		//csrfì„¤ì •
		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");
	
		$("#paymentBtn").on("click",function() {
		    let value = $('#value').val();
		    let userId = '[[${user.memberId}]]';
		    let userName = '[[${user.name}]]';
		    let userEmail =  '[[${user.email}]]';
		    let userAddr ='[[${user.addr}]]';
		    let userpostalCode ='[[${user.postalCode}]]';
		    let userTel = '[[${user.phone}]]'; 

		    IMP.init('imp54500213');
			      IMP.request_pay({
			          pg : 'html5_inicis',
			          pay_method : 'card',
			          merchant_uid: 'OS_' + new Date().getTime(), // ìƒì ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì£¼ë¬¸ ë²ˆí˜¸
			          name : userName,
			          amount : value, // í…ŒìŠ¤íŠ¸ë¼ì„œ 10ì›ë§Œ ê²°ì œ ^^;
			          buyer_email : userEmail, // êµ¬ë§¤ì ì´ë©”ì¼
			          buyer_name : userName, // êµ¬ë§¤ì ì´ë¦„
			          buyer_tel : userTel, // êµ¬ë§¤ì ì—°ë½ì²˜
			          buyer_addr : userAddr, // êµ¬ë§¤ì ì£¼ì†Œ
			          buyer_postcode : userpostalCode // êµ¬ë§¤ì ìš°í¸ë²ˆí˜¸
			      }, function(rsp) {
			          if ( rsp.success ) {
				             //ì„±ê³µì‹œ
				             let paymentId = rsp.imp_uid;
				             let paymentMethod = rsp.pay_method;
				             $('input[name=paymentId]').val(paymentId); 
				             $('input[name=paymentMethod]').val(paymentMethod); 
				             
				             var formData = new FormData(document.inputFrm);
				             //ì„±ê³µì‹œ ë“±ë¡ ë²„íŠ¼ ë„ìš°ê¹…!
				             $.ajax({
					               url: '/inputTeamChal',
					               enctype: 'multipart/form-data',
					               method: 'POST',
					               processData: false,
								   contentType: false,
					               beforeSend : function(xhr)
						               {   /*ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì •í•œë‹¤*/
						              	 xhr.setRequestHeader(header, token);
						               },
					               data: formData,
					               dataType:'json',
					               success: function (result) {
					                // ê²°ì œê¸ˆì•¡ì´ ì¼ì¹˜í•œì§€, ë‹¤ë¥¸ ì •ë³´ ì²´í¬í•˜ê³  ì¼ì¹˜í•˜ë©´ DBì— ì €ì¥í•˜ê³  ë°ì´í„°ë¥¼ ë¦¬í„´
					                   if (result) {
					                      // dataê°€ ìˆìœ¼ë©´ ì œëŒ€ë¡œ ì²˜ë¦¬ëœê²ƒ
					                      // ì´í›„ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ë„˜ì–´ê°ˆ ì»¨íŠ¸ë¡¤ê³¼ ë°ì´ì–´ ì‘ì„±
					                      var msg = 'ê²°ì œ ë° ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
					                      msg += '\nê³ ìœ ID : ' + rsp.imp_uid;
					                      msg += '\nìƒì  ê±°ë˜ID : ' + rsp.merchant_uid;
					                      msg += '\ê²°ì œ ê¸ˆì•¡ : ' + rsp.paid_amount;
					                      msg += 'ì¹´ë“œ ìŠ¹ì¸ë²ˆí˜¸ : ' + rsp.apply_num;
					                      alert(msg);
					                      location.href="/chalList";
					                   } else {
					                      //[3] ì•„ì§ ì œëŒ€ë¡œ ê²°ì œê°€ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
					                      //[4] ê²°ì œëœ ê¸ˆì•¡ì´ ìš”ì²­í•œ ê¸ˆì•¡ê³¼ ë‹¬ë¼ ê²°ì œë¥¼ ìë™ì·¨ì†Œì²˜ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.
					                      // ìœ„ì— ê°™ì€ ì´ìœ ë¡œ ì•Œë¦¼ ë„ìš°ê¸°
					                   }
					               },
					               error: function (error) {
					                  console.log(error);
					                  alert('ì‹¤íŒ¨');
					               }
					          });
				         } else {
				              var msg = 'ê²°ì œì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.';
				              msg += 'ì—ëŸ¬ë‚´ìš© : ' + rsp.error_msg;
				              
				              alert(msg);
				          }
				      }); 
	});
	
		var slider = document.getElementById("teamFee");
		var output = document.getElementById("value");
		output.innerHTML = slider.value;	
		slider.oninput = function() {
		    output.value = this.value;
		}
		output.oninput = function() {
		    slider.value = this.value;
		}
		
		let betPoint = document.getElementById("betPoint");
		betPoint.value = Number(output.value)*0.01;
		
		function changePoint(money){
			betPoint.value = Number(money)*0.01;
		}
		
		function checkStart(){
			let today = new Date();
			let start = new Date($('input[name=startDate]').val());
			if(start < today){
				alert('ì˜¤ëŠ˜ ë‚ ì§œ ì´í›„ë¡œ ì„ íƒí•´ ì£¼ì„¸ìš”');
				$('input[name=startDate]').val("");
			}
			
		}
		
		function checkDate(){
			let today = new Date();
			let start = new Date($('input[name=startDate]').val());
			let end = new Date($('input[name=endDate]').val());
			if(start>end){
				alert('ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤ ');
				$('input[name=endDate]').val("");
			}else if(end<today){
				alert('ì˜¤ëŠ˜ ë‚ ì§œ ì´í›„ë¡œ ì„ íƒí•´ ì£¼ì„¸ìš”');
				$('input[name=endDate]').val("");	
			}
			
		}
		
		function checkCnt(){
			let cnt = Number($('input[name=usercnt]').val());
			if(cnt%2 ==1){
				alert("ì§ìˆ˜ë¡œ ì…ë ¥ í•´ ì£¼ì„¸ìš”");
				$('input[name=usercnt]').val("")	
			}else if(cnt>20){
				alert("ìµœëŒ€ ì¸ì›ì€ 20ëª… ì…ë‹ˆë‹¤.");
				$('input[name=usercnt]').val("")	
			}
			
		}
		</script>

		<!-- JS -->
		<th:block layout:fragment="script">
			<script
				th:src="@{//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery-3.3.1.min.js}"></script>
			<script th:src="@{/shoptemplate/js/bootstrap.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery.nice-select.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery-ui.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery.slicknav.js}"></script>
			<script th:src="@{/shoptemplate/js/mixitup.min.js}"></script>
			<script th:src="@{/shoptemplate/js/owl.carousel.min.js}"></script>
			<script th:src="@{/shoptemplate/js/main.js}"></script>
		</th:block>
	</div>

</body>

</html>