<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
   xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{layout/layout}">
<!-- sss -->
<!-- index.html 고유 CSS 추가 -->
<head>
<style type="text/css">
button {
   all: unset;
   background-color: mediumslateblue;
   color: white;
   padding: 5px 25px;
   border-radius: 10px;
   cursor: pointer;
}

.btn {
   margin-top: 60px;
}

.modal {
   display: flex;
   justify-content: center;
   align-items: center;
   position: fixed;
   top: 0;
   left: 0;
   width: 100%;
   height: 100%;
}

.modal__background {
   background-color: rgba(0, 0, 0, 0.6);
   width: 100%;
   height: 100%;
   position: absolute;
}

.modal__content {
   text-align: center;
   position: relative;
   background-color: white;
   border-radius: 10px;
   top: 0;
   padding: 10px 25px;
   width: 20%;
}

h1 {
   margin: 0;
   margin-bottom: 13px;
}

.hidden {
   display: none;
}
</style>
</head>

<th:block layout:fragment="css">
   <!--    <link rel="stylesheet" th:href="@{/css/page/home.css}" >-->
   <link rel="stylesheet" th:href="@{/challengers/css/mycss.css}">
   <link rel="stylesheet" th:href="@{/shoptemplate/css/style.css}"
      type="text/css">
   <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous">

</th:block>
<script src="/resources/vendor/bootstrap/js/bootstrap.min.js"></script>





<!-- Content -->
<div layout:fragment="content">

   <section class="breadcrumb-section set-bg"
      th:data-setbg="@{/shoptemplate/img/breadcrumb.jpg}">
      <div class="container">
         <div class="row">
            <div class="col-lg-12 text-center">
               <div class="breadcrumb__text">
                  <h2>Challengers</h2>
                  <div class="breadcrumb__option">
                     <a href="./index.html">Home</a> <a href="./index.html">Vegetables</a>
                     <span>Vegetable’s Package</span>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </section>

   <div class="app-container">


      <div class="app-content">

         <div class="app-sidebar">
            <a href="/mypage/myCurrentChal" class="app-sidebar-link active">
            	 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                  viewBox="0 0 24 24" fill="none" stroke="currentColor"
                  stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="feather feather-home">
			          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
			          <polyline points="9 22 9 12 15 12 15 22" />
			     </svg>
            </a>
            <a href="/mypage/myBeforeChal" class="app-sidebar-link"> 
            	<svg
                  class="link-icon feather feather-pie-chart"
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                  fill="none" stroke="currentColor" stroke-linecap="round"
                  stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
          			<defs />
          			<path d="M21.21 15.89A10 10 0 118 2.83M22 12A10 10 0 0012 2v10z" />
        		</svg>
            </a> 
            <a href="/mypage/myEndChal" class="app-sidebar-link">
            	 <svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                  viewBox="0 0 24 24" fill="none" stroke="currentColor"
                  stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="feather feather-calendar">
		          <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
		          <line x1="16" y1="2" x2="16" y2="6" />
		          <line x1="8" y1="2" x2="8" y2="6" />
		          <line x1="3" y1="10" x2="21" y2="10" /></svg>
            </a> 
            <a href="/mypage/myApplyNgo" class="app-sidebar-link">
            	 <svg
                  class="link-icon feather feather-pie-chart"
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                  fill="none" stroke="currentColor" stroke-linecap="round"
                  stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
          		<defs />
          		<circle cx="12" cy="12" r="3" />
         		 <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z" />
        		</svg>
            </a>
         </div>
         
         
         <div class="projects-section">
            <div class="projects-section-header">
               <p>진행 중 챌린저스</p>
               <p class="time">December, 12</p>
            </div>
            <div class="projects-section-line">
               <div class="projects-status">
                  <div class="item-status">
                     <span class="status-number">45</span> <span class="status-type">In
                        Progress</span>
                  </div>
                  <div class="item-status">
                     <span class="status-number">24</span> <span class="status-type">Upcoming</span>
                  </div>
                  <div class="item-status">
                     <span class="status-number">62</span> <span class="status-type">Total
                        Projects</span>
                  </div>
               </div>
               <div class="view-actions">
                  <button class="view-btn list-view" title="List View">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="feather feather-list">
                                <line x1="8" y1="6" x2="21" y2="6" />
                                <line x1="8" y1="12" x2="21" y2="12" />
                                <line x1="8" y1="18" x2="21" y2="18" />
                                <line x1="3" y1="6" x2="3.01" y2="6" />
                                <line x1="3" y1="12" x2="3.01" y2="12" />
                                <line x1="3" y1="18" x2="3.01" y2="18" /></svg>
                  </button>
                  <button class="view-btn grid-view active" title="Grid View">
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="feather feather-grid">
              <rect x="3" y="3" width="7" height="7" />
              <rect x="14" y="3" width="7" height="7" />
              <rect x="14" y="14" width="7" height="7" />
              <rect x="3" y="14" width="7" height="7" /></svg>
                  </button>
               </div>
            </div>
            <div class="project-boxes jsGridView">
               <!-- 한개 -->
               <div class="project-box-wrapper" th:each="chal:${chals}">
                  <div class="project-box" style="background-color: #fee4cb;" >
                     <a th:href="@{/mypage/myChalStatus(chalId = ${chal.chalId})}">
	                     <div class="project-box-header"></div>
	                     <div class="project-box-content-header">
	                        <p class="box-content-header" th:text="${chal.chalName}">Web
	                           Designing</p>
	                        <p class="box-content-subheader" th:text="${chal.subClass}+'전'">Prototyping</p>
	                        <input type="hidden" th:name="chalId" th:value="${chal.chalId}">
	                     </div>
	                     <p th:text="${#dates.format(chal.startDate, 'MM월 dd일')} + ' ~ ' + ${#dates.format(chal.endDate, 'MM월 dd일')}"></p>
	                     <p th:text="'인증 요일 : '+${chal.frequency}"></p>
                     </a>
                     <div class="project-box-footer">
                        <div class="participants">
                           <button class="openBtn" th:if="${chal.day}==0 and ${chal.checkDate>0}">인증하기</button>
                           <button th:if="${chal.day}>0">인증완료</button>
                           <button th:if="${chal.checkDate}==0">인증하는 날이 아닙니다</button>
                        </div>
                        <div class="days-left" style="color: #ff942e;" th:text="${chal.dday}+'days left'"></div>
                     </div>
					
                  </div>

                  <!-- 모달창 -->
                  <div class="modal hidden">
                     <div class="modal__background"></div>
                     <div class="modal__content">

                        <h3>인증하기</h3>
                     	<form name="inputFrm" class="form" enctype="multipart/form-data">
                     		<input type="hidden" id="token" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/> 
	                        <p th:text="'챌린지 명 : '+${chal.chalName}"></p>
	                        <div class="modalText">
	                           <img style="width: 500px;" id="preview_image"
	                              src="https://dummyimage.com/500x500/ffffff/000000.png&text=preview+image">
	                           <input style="display: block;" type="file" id="input_image"
	                              name="uploadFile">
	                           <input type="hidden" th:value="${chal.chalId}" id="chalId" name="chalId"></p>
	                           <textarea id="content" name="content"></textarea>
	                           <button type="button" th:onclick="inputProof()">인증하기</button>
	                           <button type="button" class="closeBtn">닫기</button>
	                        </div>
                     	</form>
                     </div>
                  </div>
                  <!-- 모달창 끛-->
               </div>
            </div>
         </div>
      </div>
   </div>

   <!-- index.html 고유 스크립트 추가 -->
   <th:block layout:fragment="script">
      <script th:src="@{/shoptemplate/js/main.js}"></script>
   </th:block>
   <script type="text/javascript">
   var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");
	
      document.addEventListener('DOMContentLoaded', function() {
         var modeSwitch = document.querySelector('.mode-switch');

         modeSwitch.addEventListener('click', function() {
            document.documentElement.classList.toggle('dark');
            modeSwitch.classList.toggle('active');
         });

         var listView = document.querySelector('.list-view');
         var gridView = document.querySelector('.grid-view');
         var projectsList = document.querySelector('.project-boxes');

         listView.addEventListener('click', function() {
            gridView.classList.remove('active');
            listView.classList.add('active');
            projectsList.classList.remove('jsGridView');
            projectsList.classList.add('jsListView');
         });

         gridView.addEventListener('click', function() {
            gridView.classList.add('active');
            listView.classList.remove('active');
            projectsList.classList.remove('jsListView');
            projectsList.classList.add('jsGridView');
         });

         document.querySelector('.messages-btn').addEventListener(
               'click',
               function() {
                  document.querySelector('.messages-section').classList
                        .add('show');
               });

         document.querySelector('.messages-close').addEventListener(
               'click',
               function() {
                  document.querySelector('.messages-section').classList
                        .remove('show');
               });
      });

      //모달창 생성
      document.querySelectorAll(".openBtn").forEach((openBtn) => {
         console.log(openBtn);
         openBtn.addEventListener("click", displayModal);
         
      })
      const modal = document.querySelector(".modal");
      const closeButton = modal.querySelector(".closeBtn");
      const modalBackground = modal.querySelector(".modal__background");

      function displayModal() {
         modal.classList.toggle("hidden");
      }

      
      closeButton.addEventListener("click", displayModal)
      modalBackground.addEventListener("click", displayModal);
      //=----모달창관련 스크립트 끝
      
      //모달창에서 사진 미리보기 띄우기 
      function readImage(input) {
          // 인풋 태그에 파일이 있는 경우
          if(input.files && input.files[0]) {
              // 이미지 파일인지 검사 (생략)
              // FileReader 인스턴스 생성
              const reader = new FileReader()
              // 이미지가 로드가 된 경우
              reader.onload = e => {
                  const previewImage = document.getElementById("preview_image")
                  previewImage.src = e.target.result
              }
              // reader가 이미지 읽도록 하기
              reader.readAsDataURL(input.files[0])
          }
      }
      
      //모달창한테 값넘기기 ㅋㅋ
      
      // input file에 change 이벤트 부여
      const inputImage = document.getElementById("input_image")
      inputImage.addEventListener("change", e => {
          readImage(e.target)
      })

   function inputProof(){
         var formData = new FormData(document.inputFrm);
         $.ajax({
             url:'/mypage/myCurrentChal',
             enctype: 'multipart/form-data',
             method: 'POST',
             processData: false,
			 contentType: false,
             beforeSend : function(xhr)
             {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
            	 xhr.setRequestHeader(header, token);
             },
             data: formData,
             dataType:'json',
             success : function(result){
                console.log(result);
                alert('인증 첨부 성공❤❤');
                //location.href="http://localhost/mypage/myCurrentChal";
             },
             error : function(error){
                console.log(error);
             }
          }) 
      }

   </script>
</div>
</html>