<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<!-- index.html 고유 CSS 추가 -->
<head>
<style type="text/css">
button {
	all: unset;
	background-color: rgb(242, 210, 215);
	color: white;
	padding: 5px 25px;
	border-radius: 10px;
	cursor: pointer;
}

.btn {
	margin-top: 60px;
}

.modal {
	display: flex;
	justify-content: center;
	align-items: center;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
}

.modal__background {
	background-color: rgba(0, 0, 0, 0.6);
	width: 100%;
	height: 100%;
	position: absolute;
}

.modal__content {
	text-align: center;
	position: relative;
	background-color: white;
	border-radius: 10px;
	top: 0;
	padding: 10px 25px;
	width: 20%;
}

h1 {
	margin: 0;
	margin-bottom: 13px;
}

.hidden {
	display: none;
}

/* 표 */
	table {
	  border: 1px #a39485 solid;
	  font-size: .9em;
	  box-shadow: 0 2px 5px rgba(0,0,0,.25);
	  width: 800px;
	  border-collapse: collapse;
	  border-radius: 5px;
	  overflow: hidden;
	}
	
	th {
	  text-align: left;
	}
	  
	thead {
	  font-weight: bold;
	  color: #fff;
	  background: #73685d;
	}
	  
	 td, th {
	  padding: 1em .5em;
	  vertical-align: middle;
	}
	  
	 td {
	  border-bottom: 1px solid rgba(0,0,0,.1);
	  background: #fff;
	}
	
	a {
	  color: #73685d;
	}
	  
	 @media all and (max-width: 768px) {
	    
	  table, thead, tbody, th, td, tr {
	    display: block;
	  }
	  
	  th {
	    text-align: right;
	  }
	  
	  table {
	    position: relative; 
	    padding-bottom: 0;
	    border: none;
	    box-shadow: 0 0 10px rgba(0,0,0,.2);
	  }
	  
	  thead {
	    float: left;
	    white-space: nowrap;
	  }
	  
	  tbody {
	    overflow-x: auto;
	    overflow-y: hidden;
	    position: relative;
	    white-space: nowrap;
	  }
	  
	  tr {
	    display: inline-block;
	    vertical-align: top;
	  }
	  
	  th {
	    border-bottom: 1px solid #a39485;
	  }
	  
	  td {
	    border-bottom: 1px solid #e5e5e5;
	  }
	  
	  
	  }
</style>
</head>

<th:block layout:fragment="css">
	<!--    <link rel="stylesheet" th:href="@{/css/page/home.css}" >-->
	<link rel="stylesheet" th:href="@{/challengers/css/mycss.css}">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/style.css}"
		type="text/css">
	<link
		href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
		rel="stylesheet"
		integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
		crossorigin="anonymous">

</th:block>
<script src="/resources/vendor/bootstrap/js/bootstrap.min.js"></script>





<!-- Content -->
<div layout:fragment="content">

	<section class="breadcrumb-section set-bg"
		th:data-setbg="@{/shoptemplate/img/breadcrumb.jpg}">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 text-center">
					<div class="breadcrumb__text">
						<h2>Challengers</h2>
						<div class="breadcrumb__option">
							<a href="./index.html">Home</a> <a href="./index.html">Vegetables</a>
							<span>Vegetable’s Package</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<div class="app-container">


		<div class="app-content">

			<div class="app-sidebar">
				<a href="" class="app-sidebar-link active"> <svg
						xmlns="http://www.w3.org/2000/svg" width="24" height="24"
						viewBox="0 0 24 24" fill="none" stroke="currentColor"
						stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
						class="feather feather-home">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
          <polyline points="9 22 9 12 15 12 15 22" /></svg>
				</a> <a href="" class="app-sidebar-link"> <svg
						class="link-icon feather feather-pie-chart"
						xmlns="http://www.w3.org/2000/svg" width="24" height="24"
						fill="none" stroke="currentColor" stroke-linecap="round"
						stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
          <defs />
          <path
							d="M21.21 15.89A10 10 0 118 2.83M22 12A10 10 0 0012 2v10z" />
        </svg>
				</a> <a href="" class="app-sidebar-link"> 
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
						viewBox="0 0 24 24" fill="none" stroke="currentColor"
						stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
						class="feather feather-calendar">
				          <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
				          <line x1="16" y1="2" x2="16" y2="6" />
				          <line x1="8" y1="2" x2="8" y2="6" />
				          <line x1="3" y1="10" x2="21" y2="10" />
					</svg>
				</a> <a href="" class="app-sidebar-link"> <svg
						class="link-icon feather feather-pie-chart"
						xmlns="http://www.w3.org/2000/svg" width="24" height="24"
						fill="none" stroke="currentColor" stroke-linecap="round"
						stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
          <defs />
          <circle cx="12" cy="12" r="3" />
          <path
							d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z" />
        </svg>
				</a>
			</div>
			<div class="projects-section">
				<div class="projects-section-header">
					<p>내가 신청한 기부처</p>
					<p class="time">December, 12</p>
				</div>
				<div class="projects-section-line">
					<div class="projects-status">
						<div class="item-status">
							<span class="status-number">45</span> <span class="status-type">In
								Progress</span>
						</div>
						<div class="item-status">
							<span class="status-number">24</span> <span class="status-type">Upcoming</span>
						</div>
						<div class="item-status">
							<span class="status-number">62</span> <span class="status-type">Total
								Projects</span>
						</div>
					</div>
					<div class="view-actions">
						<button class="view-btn list-view" title="List View">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
								viewBox="0 0 24 24" fill="none" stroke="currentColor"
								stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
								class="feather feather-list">
						              <line x1="8" y1="6" x2="21" y2="6" />
						              <line x1="8" y1="12" x2="21" y2="12" />
						              <line x1="8" y1="18" x2="21" y2="18" />
						              <line x1="3" y1="6" x2="3.01" y2="6" />
						              <line x1="3" y1="12" x2="3.01" y2="12" />
						              <line x1="3" y1="18" x2="3.01" y2="18" /></svg>
						</button>
						<button class="view-btn grid-view active" title="Grid View">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
								viewBox="0 0 24 24" fill="none" stroke="currentColor"
								stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
								class="feather feather-grid">
              <rect x="3" y="3" width="7" height="7" />
              <rect x="14" y="3" width="7" height="7" />
              <rect x="14" y="14" width="7" height="7" />
              <rect x="3" y="14" width="7" height="7" /></svg>
						</button>
					</div>
				</div>
				<div class="project-boxes jsGridView">
					<!-- 한개 -->
					 <div class="project-box-wrapper" >
					 		<table>
							    <thead>
							    <tr>
							        <th>신청번호</th>
							        <th>기부처 명</th>
							        <th>신청 상태</th>
							        <th>신청서 확인</th>
							    </tr>
							    </thead>
							    <tbody>
							    <tr th:each="ngo:${ngoes}">
								   	<td th:text="${ngo.ngoId}"></td>
									<td th:text="${ngo.ngoName}" ></td>
									<td th:text="${ngo.condition}" id="condition"></td>
									<td><button type="button" th:onclick="displayModal([[${ngo}]])">확인</button></td>
							    </tr>
							    </tbody>
							</table>
						<div class="project-box">
							

						</div>

						<!--모달창  --> 
						<div class="modal hidden">
							<div class="modal__background"></div>
							<div class="modal__content">

								<div class="modalText" id="applyFrm">
										<div id="reason">
											<p>반려사유 : </p>
											<p id="rejectReason"></p>
										</div>
										<h4>기부 신청서</h4>
										<input type="hidden" id="ngoId">
										<label>기부처 명 : </label><input type="text" id="ngoName" name="ngoName" readOnly>
										<br>
										<label for="ngoNo">사업자 등록번호</label>
										<input type="number" id="ngoNo" name="ngoNo">
										<br>
										<label for="ngoNo">신청자</label>
										<input type="text" id="writerId" name="writerId">
										<br>
										
										<div id="address">
											<label>주소</label>
											<input type="text" name="postalCode" id="postalCode">
											<input type="text" name="addr" id="addr">
											<input type="text" name="detailAddr" id="detailAddr">
											<br>
										</div>
										
										<div id = "apiAddress">
											<input type="text" id="sample6_postcode" placeholder="우편번호" name="postalCode">
											<input type="button" onclick="sample6_execDaumPostcode()" value="우편번호 찾기"><br>
											<input type="text" id="sample6_address" placeholder="주소" name="addr"><br>
											<input type="text" id="sample6_detailAddress" placeholder="상세주소" name="detailAddr">
											<input type="text" id="sample6_extraAddress" placeholder="참고항목">
											<br>
										</div>
												
										<label>이메일</label>
										<input type="email" name="email" id="email">
										<br>
												
										<label>연락처</label>
										<input type="text" name="phone" id="phone">
										<br>
												
										<label>계좌</label>
										<input type="text" name="bank" id="bank">
										<input type="text" name="bankAccount" id="bankAccount">
										<br>
										
										<button type="button" id="reSubmit" onclick="reSubmit()">재신청</button>
										<span id="msg"><p>재반려된 건은 재 신청이 불가능 합니다</p></span>
										<button type="button" class="closeBtn">닫기</button>
										</div>
										
										
							
							</div>
						</div>
						<!--모달창 끛  -->
					</div> 
				</div>
			</div>
		</div>
	</div>

	<!-- index.html 고유 스크립트 추가 -->
	<th:block layout:fragment="script">
		<script th:src="@{/shoptemplate/js/main.js}"></script>
	</th:block>
	<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<script type="text/javascript">
	//csrf설정
	 var token = $("meta[name='_csrf']").attr("content");
	 var header = $("meta[name='_csrf_header']").attr("content");
	 
	 
		document.addEventListener('DOMContentLoaded', function() {
			var modeSwitch = document.querySelector('.mode-switch');

			modeSwitch.addEventListener('click', function() {
				document.documentElement.classList.toggle('dark');
				modeSwitch.classList.toggle('active');
			});

			var listView = document.querySelector('.list-view');
			var gridView = document.querySelector('.grid-view');
			var projectsList = document.querySelector('.project-boxes');

			listView.addEventListener('click', function() {
				gridView.classList.remove('active');
				listView.classList.add('active');
				projectsList.classList.remove('jsGridView');
				projectsList.classList.add('jsListView');
			});

			gridView.addEventListener('click', function() {
				gridView.classList.add('active');
				listView.classList.remove('active');
				projectsList.classList.remove('jsListView');
				projectsList.classList.add('jsGridView');
			});

			document.querySelector('.messages-btn').addEventListener(
					'click',
					function() {
						document.querySelector('.messages-section').classList
								.add('show');
					});

			document.querySelector('.messages-close').addEventListener(
					'click',
					function() {
						document.querySelector('.messages-section').classList
								.remove('show');
					});
		});
		
		
		//우편번호
		function sample6_execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var addr = ''; // 주소 변수
                var extraAddr = ''; // 참고항목 변수

                //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                    addr = data.roadAddress;
                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                    addr = data.jibunAddress;
                }

                // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                if(data.userSelectedType === 'R'){
                    // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                    // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                    if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                        extraAddr += data.bname;
                    }
                    // 건물명이 있고, 공동주택일 경우 추가한다.
                    if(data.buildingName !== '' && data.apartment === 'Y'){
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                    if(extraAddr !== ''){
                        extraAddr = ' (' + extraAddr + ')';
                    }
                    // 조합된 참고항목을 해당 필드에 넣는다.
                    document.getElementById("sample6_extraAddress").value = extraAddr;
                
                } else {
                    document.getElementById("sample6_extraAddress").value = '';
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('sample6_postcode').value = data.zonecode;
                document.getElementById("sample6_address").value = addr;
                // 커서를 상세주소 필드로 이동한다.
                document.getElementById("sample6_detailAddress").focus();
            }
        }).open();
    };
		//모달창 생성
		document.querySelectorAll(".openBtn").forEach((openBtn) => {
			console.log(openBtn);
			openBtn.addEventListener("click", displayModal);
			
		})
		const modal = document.querySelector(".modal");
		const closeButton = modal.querySelector(".closeBtn");
		const modalBackground = modal.querySelector(".modal__background");

		function displayModal(data) {
			let con = $('#condition').text();
			if(con =='반려'){
				$('#rejectReason').text(data.reason);
				$('#reason').show();
				$('#reSubmit').show();
				$('#msg').hide();
				$('#address').hide();
				$('#sample6_postcode').val(data.postalCode);
				$('#sample6_address').val(data.addr);
				$('#sample6_detailAddress').val(data.detailAddr);
				$('#apiAddress').show();
				$("input").attr("readOnly", false);
			}else if( con == '재반려'){
				$('#reason').show();
				$('#reSubmit').hide();
				$('#msg').show();
				$('#postalCode').val(data.postalCode);
				$('#addr').val(data.addr);
				$('#detailAddr').val(data.detailAddr);
				$('#address').show();
				$('#apiAddress').hide();
				$("input").attr("readOnly", true);
			}else{
				$('#reason').hide();
				$('#reSubmit').hide();
				$('#msg').hide();
				$('#postalCode').val(data.postalCode);
				$('#addr').val(data.addr);
				$('#detailAddr').val(data.detailAddr);
				$('#address').show();
				$('#apiAddress').hide();
				$("input").attr("readOnly", true);
			}
			
			$('#ngoName').val(data.ngoName);
			$('#ngoNo').val(data.ngoNo);
			$('#writerId').val(data.writerId);
			$('#email').val(data.email);
			$('#phone').val(data.phone);
			$('#bank').val(data.bank);
			$('#bankAccount').val(data.bankAccount);
			$('#ngoId').val(data.ngoId);

			modal.classList.toggle("hidden");
		}

		
		closeButton.addEventListener("click", displayModal)
		modalBackground.addEventListener("click", displayModal);
		//=----모달창관련 스크립트 끝
		
		//재신청 ㅋㅋ
		function reSubmit(){
			
			let ngoName = $('#ngoName').val();
			console.log(ngoName);
			let ngoNo = $('#ngoNo').val();
			let writerId = $('#writerId').val();
			let postalCode = $('#sample6_postcode').val();
			let addr = $('#sample6_address').val();
			let detailAddr = $('#sample6_detailAddress').val();
			let email = $('#email').val();
			let phone = $('#phone').val();
			let bank = $('#bank').val();
			let bankAccount = $('#bankAccount').val();
			let ngoId = $('#ngoId').val();
			
			$.ajax({
	    		  url : '/mypage/reSubmit',
	    		  method : 'POST',
	    		  beforeSend : function(xhr)
	               {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
	               xhr.setRequestHeader(header, token);
	               },
	    		  contentType: 'application/json',
				  data: JSON.stringify({ngoId:ngoId, condition : "재신청" , ngoName : ngoName,
					  		writerId : writerId, postalCode:postalCode, addr : addr, detailAddr : detailAddr,
					  		email : email, phone:phone, bank : bank, bankAccount:bankAccount}),
				  success:function(result){
					  alert("재신청 완료");
					  
				  }, 
	    		 error : function(error){
	    			 console.log(error);
	    		 }
			})	 
		}


	</script>
</div>
</html>