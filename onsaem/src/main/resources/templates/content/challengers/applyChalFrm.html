<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">


<!-- Google Font -->
<link
	href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap"
	rel="stylesheet">

<!-- Css  -->
<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/bootstrap.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/font-awesome.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/elegant-icons.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/nice-select.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/shop/css/jquery-ui.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/owl.carousel.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/slicknav.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/style.css}"
		type="text/css">
</th:block>
<head>
<style type="text/css">
	/*í—¤ë”  */
	/* ONE */
		.p1 li {
			font-size: 14px;
			width: 40px;
			height: 40px;
			line-height: 40px;
			padding: 0;
			text-align: center;
			float: left;
			cursor: pointer;
		}
		
		.main {
			flex-grow: 1;
			display: flex;
			flex-direction: column;
			min-width: 1400px;
		}
		
		.main-container {
			padding: 20px;
			flex-grow: 1;
			overflow: auto;
			background-color: #FCFBFC;
		}
		
		.profile-cover {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			object-fit: cover;
			object-position: center;
			border-radius: 4px;
		}
		
		.subheader {
			position: relative;
			height: 300px;
			min-height: 250px;
			z-index: 1;
			display: flex;
			justify-content: center;
			align-items: center;
			background-size: cover;
			background-position: center;
		}
		
		.subheader:before {
			content: "";
			width: 100%;
			height: 100%;
			position: absolute;
			z-index: -1;
			left: 0;
			top: 0;
			background-image: url("/course/chal.gif");
			background-repeat: no-repeat;
			background-size: cover;
			background-position: center;
			filter: blur(30px);
			opacity: 0.7;
		}
		
		.glass {
			height: 100%;
			width: 100%;
			background-image: url("/course/chal.gif");
			background-size: cover;
			background-position: center;
			clip-path: inset(10em);
			filter: blur(5px);
			display: flex;
			justify-content: center;
			align-items: center;
		}
		
		.drop-shadow {
			height: 155%;
			width: 100%;
			filter: drop-shadow(0px 20px 10px rgba(0, 0, 0, 0.3));
			display: flex;
			justify-content: center;
			align-items: center;
		}
		
		.drop-shadow:before {
			display: block;
			content: "";
			position: absolute;
			top: 10em;
			height: calc(100% - 20em);
			width: calc(100% - 20em);
			border-top: 2px solid rgba(225, 225, 225, 0.2);
			border-left: 1px solid rgba(225, 225, 225, 0.1);
			border-right: 1px solid rgba(225, 225, 225, 0.3);
			z-index: 2;
		}
		
		.drop-shadow>span {
			position: absolute;
			z-index: 5;
			color: white;
			font-size: 4em;
			letter-spacing: 0.75em;
			padding-left: 0.375em;
		}
		
		.sidebar {
			padding: 20px 30px;
			background-color: #ffffff;
			border-radius: 10px;
			margin-bottom: 10px;
		}
		
		.col-lg-9 {
			background-color: #ffffff;
			padding: 20px 30px;
			border-radius: 20px;
			margin-bottom: 10px;
		}
		
		.product {
			padding-top: 0px;
			padding-bottom: 80px;
			position: relative;
			z-index: 1;	
		}
		.modalBtns{
		border-radius : 5px;
		width : 85px;
		height : 40px;
		background-color:#9dc2c0;
		border : none;
		color : white;
		font-weight : bold;
			
	}
	.modalBtns:hover{
		background-color:#DBC8E8;
		color : #717275;
		font-weight : bold;
	}
	.info{
		background-color:#f6f8f9;
		border : none;
		border-radius : 19px;
		margin : 5px;
		padding : 20px;
		width: 90%;
		text-align : center;
	}
</style>
</head>
<div layout:fragment="content">
<br>
    <!-- Breadcrumb Section Begin -->
   <div class="subheader">
		<img src="/course/chal.gif" alt="" class="profile-cover">
		<div class="drop-shadow">
			<div class="glass"></div>
			<span>Challengers</span>
		</div>
	</div>
    <!-- Breadcrumb Section End -->

    <!-- Product Details Section Begin -->
    <section class="product-details spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-6">
                    <div class="product__details__pic">
                        <div class="product__details__pic__item">
                            <img class="pic"
                                th:src="'/fileView/'+${thumbnail.fileRoute}" style="width:400px;height:400px;">
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="product__details__text">
                    	<input type="hidden" th:value="${chal.donationFee}" id="currentFee">
        				<input type="number" value="donationFee" id="donationFee" name="donationFee" style="display:none;">
        				<input type="hidden" th:value=${chal.chalId} name="chalId" id="chalId">
                        <h3 th:text="${chal.chalName}">Vetgetableâ€™s Package</h3>
                       <div class="product__details__price"><span th:text="'ê¸°ë¶€ì²˜ : ' + ${chal.ngoName}">$50.00</span></div>
                        <ul>
                            <li><b>ì‹œì‘ì¼</b> <span th:text="${#dates.format(chal.startDate, 'yyyyë…„ MMì›” ddì¼')}" ></span></li>
                            <li><b>ì¢…ë£Œì¼</b> <span th:text="${#dates.format(chal.endDate, 'yyyyë…„ MMì›” ddì¼')}"> <samp>Free pickup today</samp></span></li>
                            <li><b>ìœ í˜•</b> <span th:text="${chal.subClass}">0.5 kg</span></li>
                            <li><b>ì°¸ê°€ ìš”ì¼</b> <span th:text="${chal.frequency}"></span></li>
                         
                        </ul>
                        
                    
                       
                        
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="product__details__tab">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#tabs-1" role="tab"
                                    aria-selected="true">ê°œì¸ ì±Œë¦°ì €ìŠ¤</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="tabs-1" role="tabpanel">
                                <div class="product__details__tab__desc">
                                    <div style=text-align:center;>
										<h2 style="margin : 10px 0">ê¸°ë¶€ê¸ˆ ê²°ì œ</h2>
										<p style="margin : 5px 0">ğŸ’› ì±Œë¦°ì €ìŠ¤ ì°¸ê°€ ì‹œ ê¸°ë¶€ê¸ˆ ë¨¼ì € ê²°ì œ ë©ë‹ˆë‹¤ ğŸ’› </p>
										<p  style="margin : 5px 0">ğŸ’› ì±Œë¦°ì§€ ì‹œì‘ ì´í›„ ì±Œë¦°ì €ìŠ¤ ì°¸ê°€ë¥¼ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ ğŸ’› </p>
									</div>
									<div class="info" style= "margin : 20px auto">
										<p style="font-size : 20px">ê¸°ë¶€ê¸ˆ</p>
										<input id="value" value=5000 name="privateDonate" onchange="changeMoney()" style="margin : 5px 0"><span> ì›</span></input>
        								                  
                                    	<p style="font-weight: bold">ê²°ì œ ì¡°ê±´ ë° ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤.</p>
                                    	
                           			</div>
                           				<div style="text-align : center">
                                   		<input type="button" id="paymentBtn" value="ì°¸ê°€í•˜ê¸°" class="modalBtns">&nbsp;&nbsp;
										<input type="reset" value="ì·¨ì†Œ" class="modalBtns" onClick="history.go(-1)">
										</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
  			</form>
        
         <!-- JS -->
		<th:block layout:fragment="script">
			<script th:src="@{/shoptemplate/js/jquery-3.3.1.min.js}"></script>
			<script th:src="@{/shoptemplate/js/bootstrap.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery.nice-select.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery-ui.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery.slicknav.js}"></script>
			<script th:src="@{/shoptemplate/js/mixitup.min.js}"></script>
			<script th:src="@{/shoptemplate/js/owl.carousel.min.js}"></script>
			<script th:src="@{/shoptemplate/js/main.js}"></script>
			
			<!-- ê²°ì œ api -->
			
			<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
		<script>
		//csrfì„¤ì •
		 var token = $("meta[name='_csrf']").attr("content");
		 var header = $("meta[name='_csrf_header']").attr("content");
		 
			var output = document.getElementById("value");
			var currentFee = Number(document.getElementById("currentFee").value);
			
			let money = currentFee+Number(output.value);
			donationFee.value = currentFee+Number(output.value);
			
			
			function changeMoney(){
				money = currentFee+Number(output.value);
			}
		
			//ê²°ì œ ë° í…Œì´ë¸” ë“±ë¡ ã…ã… 
			
			$("#paymentBtn").on("click",function() {
		      let value = $('#value').val();
		      let chalId = $('#chalId').val();
		      let userId = '[[${user.memberId}]]';
		      let userName = '[[${user.name}]]';
		      let userEmail =  '[[${user.email}]]';
		      let userAddr ='[[${user.addr}]]';
		      let userpostalCode ='[[${user.postalCode}]]';
		      let userTel = '[[${user.phone}]]'; 

		      IMP.init('imp54500213');
			      IMP.request_pay({
			          pg : 'html5_inicis',
			          pay_method : 'card',
			          merchant_uid: 'OS_' + new Date().getTime(), // ìƒì ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì£¼ë¬¸ ë²ˆí˜¸
			          name : chalId,
			          amount : value, // í…ŒìŠ¤íŠ¸ë¼ì„œ 10ì›ë§Œ ê²°ì œ ^^;
			          buyer_email : userEmail, // êµ¬ë§¤ì ì´ë©”ì¼
			          buyer_name : userName, // êµ¬ë§¤ì ì´ë¦„
			          buyer_tel : userTel, // êµ¬ë§¤ì ì—°ë½ì²˜
			          buyer_addr : userAddr, // êµ¬ë§¤ì ì£¼ì†Œ
			          buyer_postcode : userpostalCode // êµ¬ë§¤ì ìš°í¸ë²ˆí˜¸
			      }, function(rsp) {
			          if ( rsp.success ) {
			             //ì•„ë˜ ì•„ì‘ìŠ¤ë¶€í„°ëŠ” ë³¸ì¸ì˜ ì»¨íŠ¸ë¡¤ì´ë‚˜ êµ¬í˜„ì— ë§ê²Œ ì ì ˆíˆ ì‚¬ìš©í• ê²ƒ
			             // ê²°ì œì„±ê³µí•˜ê³  ì»¨íŠ¸ë¡¤ì— ë„˜ì–´ê°€ì„œ DBì— ì •ë³´ì €ì¥ë¥¼ ìœ„í•œ ì•„ì‘ìŠ¤
			             let data = {"paymentId":rsp.imp_uid,
			            		 	"price" : value, "paymentMethod" : rsp.pay_method, 
			            		 	"groupId" : chalId, "donationFee" : money};
			             $.ajax({
			               url: '/applyChalFrm',
			               method: 'POST',
			               beforeSend : function(xhr)
			               {   /*ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì •í•œë‹¤*/
			              	 xhr.setRequestHeader(header, token);
			               },
			               contentType: 'application/json',
			               data: JSON.stringify(data),
			               success: function (result) {
			                // ê²°ì œê¸ˆì•¡ì´ ì¼ì¹˜í•œì§€, ë‹¤ë¥¸ ì •ë³´ ì²´í¬í•˜ê³  ì¼ì¹˜í•˜ë©´ DBì— ì €ì¥í•˜ê³  ë°ì´í„°ë¥¼ ë¦¬í„´
			                   if (result) {
			                      // dataê°€ ìˆìœ¼ë©´ ì œëŒ€ë¡œ ì²˜ë¦¬ëœê²ƒ
			                      // ì´í›„ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ë„˜ì–´ê°ˆ ì»¨íŠ¸ë¡¤ê³¼ ë°ì´ì–´ ì‘ì„±
			                      var msg = 'ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
			                      msg += '\nê³ ìœ ID : ' + rsp.imp_uid;
			                      msg += '\nìƒì  ê±°ë˜ID : ' + rsp.merchant_uid;
			                      msg += '\ê²°ì œ ê¸ˆì•¡ : ' + rsp.paid_amount;
			                      msg += 'ì¹´ë“œ ìŠ¹ì¸ë²ˆí˜¸ : ' + rsp.apply_num;
			                      alert(msg);
			                   } else {
			                      //[3] ì•„ì§ ì œëŒ€ë¡œ ê²°ì œê°€ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
			                      //[4] ê²°ì œëœ ê¸ˆì•¡ì´ ìš”ì²­í•œ ê¸ˆì•¡ê³¼ ë‹¬ë¼ ê²°ì œë¥¼ ìë™ì·¨ì†Œì²˜ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.
			                      // ìœ„ì— ê°™ì€ ì´ìœ ë¡œ ì•Œë¦¼ ë„ìš°ê¸°
			                   }
			               },
			               error: function (error) {
			                  console.log(error);
			                  alert('ì‹¤íŒ¨');
			               }
			          }); 
			         } else {
			              var msg = 'ê²°ì œì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.';
			              msg += 'ì—ëŸ¬ë‚´ìš© : ' + rsp.error_msg;
			              
			              alert(msg);
			          }
			      }); 
   });
			
		</script> 
		</th:block>
    </section>
    <!-- Product Details Section End -->

 	</div>
     
       
		
	  
 