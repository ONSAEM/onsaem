<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<!-- Css  -->
<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/bootstrap.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/nice-select.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/jquery-ui.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/owl.carousel.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/slicknav.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/style.css}"
		type="text/css">
</th:block>

<head>
<style>
/* GENERAL STYLES */
.pagination ul {
	margin: auto;
	padding: 0;
	list-style: none;
}

/* ONE */
.p1 li {
	font-size: 14px;
	width: 40px;
	height: 40px;
	line-height: 40px;
	padding: 0;
	text-align: center;
	float: left;
	cursor: pointer;
}

.main {
	flex-grow: 1;
	display: flex;
	flex-direction: column;
}

.main-container {
	padding: 20px;
	flex-grow: 1;
	background-color: #FCFBFC;
}

.profile-cover {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	object-fit: cover;
	object-position: center;
	border-radius: 4px;
}

.subheader {
	position: relative;
	height: 300px;
	min-height: 250px;
	z-index: 1;
	display: flex;
	justify-content: center;
	align-items: center;
	background-size: cover;
	background-position: center;
	margin-bottom: 30px;
}

.subheader:before {
	content: "";
	width: 100%;
	height: 100%;
	position: absolute;
	z-index: -1;
	left: 0;
	top: 0;
	background-image: url("/course/test.gif");
	background-repeat: no-repeat;
	background-size: cover;
	background-position: center;
	filter: blur(30px);
	opacity: 0.7;
}

.glass {
	height: 100%;
  width: 100%;
	background-image: url("/course/test.gif");
	background-size: cover;
	background-position: center;
	clip-path: inset(10em);
	filter: blur(5px);
	display: flex;
	justify-content: center;
	align-items: center;
}

.drop-shadow {
	height: 155%;
	width: 100%;
	filter: drop-shadow(0px 20px 10px rgba(0, 0, 0, 0.3));
	display: flex;
	justify-content: center;
	align-items: center;
}

.drop-shadow:before {
	display: block;
	content: "";
	position: absolute;
	top: 10em;
	height: calc(100% - 20em);
	width: calc(100% - 20em);
	border-top: 2px solid rgba(225, 225, 225, 0.2);
	border-left: 1px solid rgba(225, 225, 225, 0.1);
	border-right: 1px solid rgba(225, 225, 225, 0.3);
	z-index: 2;
}

.drop-shadow>span {
	position: absolute;
	z-index: 5;
	color: white;
	font-size: 4em;
	letter-spacing: 0.75em;
	padding-left: 0.375em;
}

@media (max-width: 980px) {
  .glass {
    clip-path: inset(7em);
  }

  .drop-shadow:before {
    top: 7em;
    width: calc(100% - 14em);
    height: calc(100% - 14em);
  }
  .drop-shadow > span {
    font-size: 4em;
  }
}
@media (max-width: 640px) {
.drop-shadow{
    height: 95%;
  }
.glass {
    clip-path: inset(3em);
  }
 .drop-shadow:before {
    top: 3em;
    width: calc(100% - 6em);
    height: calc(100% - 6em);
  }
  .drop-shadow > span {
    font-size: 2em;
  }
}

@media (max-width: 330px) {
.subheader {
height: 248px;
}
.drop-shadow{
    height: 95%;
  }
.glass {
    clip-path: inset(3em);
  }
 .drop-shadow:before {
    top: 3em;
    width: calc(100% - 6em);
    height: calc(100% - 6em);
  }
  .drop-shadow > span {
  padding-left: 0.75em;
    font-size: 1.5em;
  }
}

.col-lg-3 {
	padding-left: 0px;
}

.sidebar {
	padding: 20px 30px;
	margin-bottom: 10px;
	background-color: #ffffff;
	border-radius: 20px;
}

.col-lg-9 {
	background-color: #ffffff;
	padding: 10px 30px;
	border-radius: 20px;
	margin-bottom: 10px;
}

.product {
	padding-top: 0px;
	padding-bottom: 80px;
	position: relative;
	z-index: 1;
}

.gridView .products-row {
	margin: 8px;
	width: calc(100% - 16px);
	background-color: #f9f9f9;
	border-radius: 4px;
	cursor: pointer;
	transition: transform 0.2s;
	position: relative;
	padding-bottom: 8px;
	height: 400px;
}

.products-row img {
	border-radius: 4px 4px 0px 0px;
	height: 70%;
	width: 100%;
}

.product-cell {
	margin: 8px;
	text-align: end;
}

.classList .products-row {
	margin: 15px 26px;
	width: calc(30% - 16px);
	background-color: #f9f9f9;
	border-radius: 4px;
	cursor: pointer;
	transition: transform 0.2s;
	position: relative;
	padding-bottom: 8px;
	margin-bottom: 20px;
	height: 400px;
	border-radius: 4px;
}

.classList {
	flex-shrink: 0;
	width: 100%;
	max-width: 100%;
	padding-right: calc(var(- -bs-gutter-x)* .5);
	padding-left: calc(var(- -bs-gutter-x)* .5);
	margin-top: var(- -bs-gutter-y);
	display: flex;
	flex-wrap: wrap;
}

.sidebar__item h4 {
	color: #1c1c1c;
	font-weight: 700;
	margin-bottom: 8px;
}

#minamount {
	text-align: right;
}

#maxamount {
	text-align: left;
}

.price-input .fa-solid {
	margin: 0px 10px;
}

.classList_container {
	background-color: #ffffff;
	border-radius: 20px;
}

.pagination {
	margin-bottom: 20px;
}

.product__discount__slider.owl-carousel .owl-dots {
	margin-top: 0px;
}

.product__discount {
	padding-bottom: 5px;
}

.product__discount__title {
	margin-bottom: 30px;
	margin-top: 30px;
}

.sidebar__item {
	margin-bottom: 40px;
}

.classList_container .col-md-5 {
	margin-left: 27px;
}


</style>
</head>

<!-- Content -->

<div layout:fragment="content">
	<div class="main">
		<div class="main-container">
			<div class="subheader">
				<img src="/course/test.gif" alt="" class="profile-cover">
				<div class="drop-shadow">
					<div class="glass"></div>
					<span>CLASS</span>
				</div>
			</div>
			<!-- Product Section Begin -->
			<section class="product spad">
				<div class="container">
					<div class="row">
						<div class="col-lg-3 col-md-5">
							<div class="sidebar">
								<div class="sidebar__item">
									<h4>지역</h4>
									<select class="addr">
										<option value="">::지역선택::</option>
										<option value="서울">서울</option>
										<option value="부산">부산</option>
										<option value="대구">대구</option>
										<option value="인천">인천</option>
										<option value="광주">광주</option>
										<option value="대전">대전</option>
										<option value="울산">울산</option>
										<option value="세종">세종</option>
										<option value="경기">경기</option>
										<option value="강원">강원</option>
										<option value="충북">충북</option>
										<option value="충남">충남</option>
										<option value="전북">전북</option>
										<option value="전남">전남</option>
										<option value="경북">경북</option>
										<option value="경남">경남</option>
										<option value="제주">제주</option>
									</select> <br>
								</div>
								<div class="sidebar__item">
									<h4>가격</h4>
									<div class="price-range-wrap" style="text-align: center">
										<div
											class="price-range ui-slider ui-corner-all ui-slider-horizontal ui-widget ui-widget-content"
											th:data-min=${minPrice} th:data-max=${maxPrice}>
											<div class="ui-slider-range ui-corner-all ui-widget-header"></div>
											<span tabindex="0"
												class="ui-slider-handle ui-corner-all ui-state-default"></span>
											<span tabindex="0"
												class="ui-slider-handle ui-corner-all ui-state-default"></span>
										</div>
										<div class="range-slider">
											<div class="price-input">
												<input type="text" id="minamount"><i
													class="fa-solid fa-minus"></i><input type="text"
													id="maxamount">
											</div>
										</div>
									</div>
								</div>
								<div class="sidebar__item sidebar__item__color--option">
									<h4>날짜</h4>
									<label for="white"> 시작 <input class="startDate"
										type="date">
									</label> <label for="gray"> 종료 <input class="endDate"
										type="date">
									</label>
								</div>
								<div class="sidebar__item">
									<h4>검색</h4>
									<input type="text" class="searchWord" placeholder="검색">
								</div>
								<button type="button" class="site-btn">SEARCH</button>
							</div>
						</div>
						<div class="col-lg-9 col-md-7">
							<div class="product__discount">
								<div class="section-title product__discount__title">
									<h2 class="ko-h2">인기 클래스</h2>
								</div>
								<div class="row">
									<div class="product__discount__slider owl-carousel gridView">
										<div class="products-row" th:each="class : ${popularClass}"
											th:id="${class.classId}">
											<img th:src="'/fileView/'+${class.media.fileRoute}"
												alt="product">
											<div class="product-cell" th:text="${class.className}"></div>
											<div class="product-cell" th:text="${class.price}+'원'"></div>
											<div class="product-cell">
												<i class="fa-solid fa-star" th:if="${class.star} != 0"
													th:each="num:${#numbers.sequence(1,class.star)}"
													style="color: #ffe949"></i><i class="fa-solid fa-star-half"
													th:if="${class.star%1 >= 0.5}" style="color: #ffe949"></i>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="classList_container">
							<div class="filter__item">
								<div class="row">
									<div class="col-lg-4 col-md-5">
										<div class="filter__sort">
											<span>Sort By</span> <select name="orderId" class="orderId"
												th:onchange="newOrder()">
												<option value="OD0">최신순</option>
												<option value="OD1">별점높은순</option>
												<option value="OD2">가격높은순</option>
												<option value="OD3">가격낮은순</option>
											</select>
										</div>
									</div>
								</div>
							</div>

							<div class="classList">
								<div class="products-row" th:each="class : ${classList}"
									th:id="${class.classId}">
									<img th:src="'/fileView/'+${class.media.fileRoute}"
										alt="product">
									<div class="product-cell" th:text="${class.className}"></div>
									<div class="product-cell" th:text="${class.price}+'원'"></div>
									<div class="product-cell">
										<i class="fa-solid fa-star" th:if="${class.star} != 0"
											th:each="num:${#numbers.sequence(1,class.star)}"
											style="color: #ffe949"></i><i class="fa-solid fa-star-half"
											th:if="${class.star%1 >= 0.5}" style="color: #ffe949"></i>
									</div>
								</div>
							</div>
							<!-- 처음 페이지 열릴때는 여기서 페이징 생성, 이후 아작스로 결과값 가져올때는 자바스크립트로 생성해서 새로 넣기 -->
							<!-- 페이징 부분 -->
							<div class="pagination p1" th:if="${page.totalRecord != 0}">
								<ul>
									<!-- 페이징 시작부분이 1보다 크면 이전으로 가기 버튼 생성 ex) << -->
									<li id="prevPaging" th:if="${page.startPage > 1}"
										style="font-size: 30px;">&laquo;</li>
									<th:block
										th:each="num : ${#numbers.sequence(page.startPage,page.endPage)}">
										<!-- 페이지 생성  ex) 1 2 3 4 5-->
										<li id="pageNum" th:if="${page.page != num}" th:text=${num}></li>
										<!-- 현재페이지와 맞는 페이지는 정해진 css가 입혀서 생성-->
										<li th:if="${page.page == num}" th:text=${num}
											style="background-color: #9dc2c0; border-radius: 100%; color: #fff;"></li>
									</th:block>
									<!-- 페이징 끝부분이 페이징 마지막페이지보다 작으면 다음으로 가기 버튼 생성 ex) >> -->
									<li id="nextPaging" th:if="${page.endPage < page.lastPage}"
										style="font-size: 30px;">&raquo;</li>
								</ul>
							</div>
							<!-- 페이징 끝 -->
						</div>
					</div>
				</div>
			</section>
		</div>
	</div>

	<!-- Product Section End -->
	<script type="text/javascript">
		let nowData = {};

		$('.products-row').each(function () {
			$(this).on('click', function () {
				location.href = "/class/classDetail?classId=" + $(this).attr("id");
			})
		})

		function dataMake() {
			let data = {};
			if ($(".addr").val()) {
				data['classAddr'] = $(".addr").val();
			}
			if ($("#minamount").val().slice(0, -1)) {
				data['minPrice'] = $("#minamount").val().slice(0, -1);
			}
			if ($("#maxamount").val().slice(0, -1)) {
				data['maxPrice'] = $("#maxamount").val().slice(0, -1);;
			}
			if ($(".startDate").val()) {
				data['startDate'] = $(".startDate").val();
			}
			if ($(".endDate").val()) {
				data['endDate'] = $(".endDate").val();
			}
			if ($(".searchWord").val()) {
				data['className'] = $(".searchWord").val();
			}
			data['orderId'] = $(".orderId").val();
			return data;
		}
		// 검색
		$(".site-btn").on("click", function () {
			nowData = dataMake();
			newClassList(1);
		});

		// 페이지 이동
		$("#pageNum").each(function () {
			$(this).on("click", function () {
				newClassList($(this).text());
			});
		})

		// 다음 페이징 목록 이동
		$("#nextPaging").on("click", function () {
			newClassList("[[${page.startPage+page.pageSize}]]");
		});

		// 이전 페이징 목록 이동
		$("#prevPaging").on("click", function () {
			newClassList("[[${page.startPage-page.pageSize}]]");
		});

		// 정렬 변경
		function newOrder() {
			nowData['orderId'] = $(".orderId").val();
			newClassList(1);
		}

		// 페이징 만들기 이건 본인 css나 html에 맞춰서 할것
		function makePageing(page) {
			// 가져온 결과값이 0개면 리턴
			if (page.totalRecord == 0) {
				return;
			}
			// 페이징을 넣을 div, ul 생성
			let pagination = $("<div/>").addClass("pagination p1");
			let ul = $("<ul/>");
			// 페이징 시작부분이 1보다 크면 이전으로 가기 버튼 생성 ex) <<
			if (page.startPage > 1) {
				$(ul).append($("<li/>").html("&laquo;").css("font-size", "30px").on("click", function () { newClassList(page.startPage - page.pageSize) }));
			}
			// 페이지 생성  ex) 1 2 3 4 5
			for (let i = page.startPage; i <= page.endPage; i++) {
				if (page.page == i) {
					// 현재페이지와 맞는 페이지는 정해진 css가 입혀서 생성
					$(ul).append($("<li/>").text(i).css("background-color", "#9dc2c0").css("border-radius", "100%").css("color", "#fff"));
				} else {
					$(ul).append($("<li/>").text(i).attr("id", "pageNum").on("click", function () { newClassList($(this).text()); }));
				}
			}
			// 페이징 끝부분이 페이징 마지막페이지보다 작으면 다음으로 가기 버튼 생성 ex) >>
			if (page.endPage < page.lastPage) {
				$(ul).append($("<li/>").html("&raquo;").css("font-size", "30px").on("click", function () { newClassList(page.startPage + page.pageSize) }));
			}
			// 완성된 페이징을 넣기
			pagination.append(ul);
			return pagination;
		}

		// 강의 리스트 만들기
		function makeList(item) {
			let makeClone = $(`<div class="products-row" id="${item.classId}">
								<img src="/fileView/${item.media.fileRoute}" alt="product">
								<div class="product-cell" >${item.className}
								</div>
								<div class="product-cell" >${item.price}원
								</div>
								<div class="product-cell">
								</div>
							</div>`);
			for (let i = 1; i <= item.star; i++) {
				$(makeClone).children(".product-cell").eq(2).append($("<i/>").addClass('fa-solid fa-star').css("color", "#ffe949"));
			}
			if (item.star % 1 >= 0.5) {
				$(makeClone).children(".product-cell").eq(2).append($("<i/>").addClass('fa-solid fa-star-half').css("color", "#ffe949"));
			}
			$(makeClone).on('click', function () {
				location.href = "/class/classDetail?classId=" + $(this).attr("id");
			})
			return makeClone;
		}

		// 강의목록 가져오기
		function newClassList(page) {
			let data = nowData;
			data['page'] = page;
			$.ajax({
				url: '/class/classSearch',
				method: 'GET',
				contentType: 'application/x-www-form-urlencoded',
				data: data,
				success: function (result) {
					$(".classList").children().detach();
					$(".row").find(".pagination").detach();
					$(result["classList"]).each(function (index, item) {
						$(".classList").append(makeList(item));
					})
					// 페이징 새로 생성
					$(".classList").after(makePageing(result["newPaging"]));
				},
				error: function (error) {
					console.log(error);
					alert('실패');
				}
			})
		}

	</script>

	<!-- JS -->
	<th:block layout:fragment="script">
		<script th:src="@{/shoptemplate/js/jquery-3.3.1.min.js}"></script>
		<script th:src="@{/shoptemplate/js/bootstrap.min.js}"></script>
		<script th:src="@{/shoptemplate/js/jquery.nice-select.min.js}"></script>
		<script th:src="@{/shoptemplate/js/jquery-ui.min.js}"></script>
		<script th:src="@{/shoptemplate/js/jquery.slicknav.js}"></script>
		<script th:src="@{/shoptemplate/js/mixitup.min.js}"></script>
		<script th:src="@{/shoptemplate/js/owl.carousel.min.js}"></script>
		<script th:src="@{/shoptemplate/js/main.js}"></script>
	</th:block>
</div>

</html>