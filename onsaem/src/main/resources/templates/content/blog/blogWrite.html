<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<meta name="description" content="Ogani Template">
<meta name="keywords" content="Ogani, unica, creative, html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Ogani | Template</title>

<!-- Css  -->
<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/bootstrap.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/font-awesome.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/elegant-icons.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/nice-select.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/jquery-ui.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/owl.carousel.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/slicknav.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/style.css}"
		type="text/css">
</th:block>

<style>
 /* VARIABLES -  START */
/* COLORS  */
/* DIMENSIONS */
/* FONTS */
@import url("https://fonts.googleapis.com/css2?family=Lato:wght@300&display=swap");
/* VARIABLES - END */
/* COMMONS - START */
.flex-center, .wrapper .button-container, .wrapper {
  justiy-content: center;
  align-items: center;
}

* {
  box-sizing: border-box;
  margin: 0;
}

/* COMMONS - END */
/* STYLES -  START */
.wrapper {
  font-family: "Lato", sans-serif;
  font-weight: 400;
}
.heartbutton {
  height: 50px;
  width: 170px;
  background-color: #fefefe;
  border-radius: 5px;
  padding: 12.5px;
  cursor: pointer;
}

.content .icon {
  font-size: 25px;
  color: #ea4a87;
}
.content .icon.fa {
  display: none;
}
.content .text {
  font-size: 25px;
  color: #2f3537;
}
.content .text.like {
  margin-left: 10px;
}
.content .text.d {
  opacity: 0;
  display: inline-block;
  transform: translateX(12px);
}
.content .text.number {
  margin-left: 10px;
  color: #7a7c81;
}

/* STYLES - END */

/* 신고모달 */
.modal {
	display: flex;
	justify-content: center;
	align-items: center;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
}

.modal__background {
	background-color: rgba(0, 0, 0, 0.6);
	width: 100%;
	height: 100%;
	position: absolute;
}

.modal__content {
	text-align: center;
	position: relative;
	background-color: white;
	border-radius: 10px;
	top: 0;
	padding: 10px 25px;
	width: 20%;
}
.hidden {
	display: none;
} 
</style>

</head>

<!-- Content -->

<div layout:fragment="content">
	
	<!-- Blog Details Hero Begin -->
	<section class="blog-details-hero set-bg"
		th:data-setbg="@{/shoptemplate/img/blog/details/details-hero.jpg}">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="blog__details__hero__text">
						<h2>[[${blogWrite.writeTitle}]]</h2>
						<ul>
							<li>By [[${blogWrite.nickname}]]</li>
							<li>[[${#dates.format(blogWrite.writeDate, 'YYYY-MM-DD')}]]</li>
							<li>[[${replyCnt.replyCnt}]] Comments</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- Blog Details Hero End -->

	<!-- Blog Details Section Begin -->
	<section class="blog-details spad">
		<div class="container">
			<div class="row">
				<div class="col-lg-4 col-md-5 order-md-1 order-2">
					<div class="blog__sidebar">
						<!--                     	<button th:onclick="|location.href='@{/blog/myblog/blogWrite/blogUpdate/test01/BW001}'|">수정</button> -->
						<!--                     	<button th:onclick="|location.href='@{/blog/myblog/blogWrite/blogDelete/test01/BW001}'|">삭제</button> -->
						<div class="blog__sidebar__search">
							<form action="#">
								<input type="text" placeholder="Search...">
								<button type="submit">
									<span class="icon_search"></span>
								</button>
							</form>
						</div>
						<div class="blog__sidebar__item">
							<h4>Categories</h4>
							<ul th:each="cate:${category}">
                                <li><a href="#">[[${cate.categoryName}]]</a></li>
                            </ul>
						</div>
						<div class="blog__sidebar__item">
							<h4>Recent News</h4>
							<div class="blog__sidebar__recent">
								<a href="#" class="blog__sidebar__recent__item">
									<div class="blog__sidebar__recent__item__pic">
										<img th:src="@{/shoptemplate/img/blog/sidebar/sr-1.jpg}"
											alt="">
									</div>
									<div class="blog__sidebar__recent__item__text">
										<h6>
											09 Kinds Of Vegetables<br /> Protect The Liver
										</h6>
										<span>MAR 05, 2019</span>
									</div>
								</a> <a href="#" class="blog__sidebar__recent__item">
									<div class="blog__sidebar__recent__item__pic">
										<img th:src="@{/shoptemplate/img/blog/sidebar/sr-2.jpg}"
											alt="">
									</div>
									<div class="blog__sidebar__recent__item__text">
										<h6>
											Tips You To Balance<br /> Nutrition Meal Day
										</h6>
										<span>MAR 05, 2019</span>
									</div>
								</a> <a href="#" class="blog__sidebar__recent__item">
									<div class="blog__sidebar__recent__item__pic">
										<img th:src="@{/shoptemplate/img/blog/sidebar/sr-3.jpg}"
											alt="">
									</div>
									<div class="blog__sidebar__recent__item__text">
										<h6>
											4 Principles Help You Lose <br />Weight With Vegetables
										</h6>
										<span>MAR 05, 2019</span>
									</div>
								</a>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-8 col-md-7 order-md-1 order-1"> <!--------------------------신고!!!!! -->
					<i type="button" class="fa-solid fa-triangle-exclamation openBtn" style="float:right;"
					th:value1="${blogWrite.writeId}" th:value2="${blogWrite.blogId}">신고하기</i>
					<div class="blog__details__text">
						<img th:src="@{/shoptemplate/img/blog/details/details-pic.jpg}"
							alt=""> [(${blogWrite.blogWrite})]
					</div>
					<div class="blog__details__content">
						<div class="row">
							<div class="col-lg-6">
								<div class="blog__details__author">
									<div class="blog__details__author__pic">
										<img
											th:src="@{/shoptemplate/img/blog/details/details-author.jpg}"
											alt="">
									</div>
									<div class="blog__details__author__text">
										<h6>[[${blogWrite.nickname}]]</h6>
										<span>[[${blogWrite.blogId}]]</span>
									</div>
								</div>
							</div>
							<div class="col-lg-6">
								<div class="blog__details__widget">
									<ul>
					<!-------------------- 하트 ------------------------->
										<li><div class="wrapper" >
												<div class="button-container">
													<div class="heartbutton">
														<span class="content"> <i class="icon fa fa-heart"
															aria-hidden="true"></i> <i class="icon far fa-heart"
															aria-hidden="true"></i> <span class="text like">Like<span
																class="text d">d</span></span> <span class="text number" th:text="${cntBlogLike.count}"></span>
														</span>
														<input type="hidden" class="blogLike" th:value=${likeCount}> <!-- 초기값을 F로 두기 -->
													</div>
												</div>
											</div></li>
					<!-------------------- 하트 끝 ------------------------->	
<!-- 										<li><span>Categories:</span>[[${blogWrite.categoryName}]]</li> -->
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
<!-------------댓글--------------------------------------------------->
		<main>
			<section class="news-section section-padding">
            <div class="container">
                <div class="row">
                	<div class="author-comment d-flex mt-3 mb-4" th:each=" reply : ${replyList}">
                                    <img th:src="@{/images/avatar/studio-portrait-emotional-happy-funny.jpg}"
                                        class="img-fluid avatar-image" alt="">

                                    <div class="author-comment-info ms-3">
                                        <h6 class="mb-1"><span style="font-weight:bold" id="writerIdText">[[${reply.writerId}]]</span> ([[${#dates.format(reply.replyDate, 'YY.MM.DD HH:mm')}]])</h6>

                                        <p class="mb-0">[[${reply.content}]]</p>

                                        <div class="d-flex mt-2">
                                            <a type="button" class="author-comment-link me-3 openBtn" id="replyIdVal" th:value1="${reply.replyId}" th:value2="${reply.writerId}"><span style="color:red;">신고</span></a>

                                            <a href="#" class="author-comment-link">댓글달기</a>
                                        </div>
                                    </div>
                     </div>
						<!-- 대댓글 
                                <div class="author-comment d-flex ms-5 ps-3">
                                    <img th:src="@{/images/avatar/pretty-blonde-woman-wearing-white-t-shirt.jpg}"
                                        class="img-fluid avatar-image" alt="">

                                    <div class="author-comment-info ms-3">
                                        <h6 class="mb-1">Daisy</h6>

                                        <p class="mb-0">Sed leo nisl, posuere at molestie ac, suscipit auctor mauris.
                                            Etiam quis metus elementum, tempor risus vel, condimentum orci</p>

                                        <div class="d-flex mt-2">
                                            <a href="#" class="author-comment-link me-3">신고</a>

                                            <a href="#" class="author-comment-link">댓글달기</a>
                                        </div>
                                    </div>
                                </div>
						-->
                                <form class="custom-form comment-form mt-4" role="form" name="replyFrm">
                                    <h6 class="mb-3">댓글</h6>

                                    <textarea name="content" rows="4" class="form-control" id="comment-message"
                                        placeholder="온샘은 신고 관리를 철저하게 합니다. 댓글 작성 시, 한번 더 생각해주세요"></textarea>

                                    <div class="col-lg-3 col-md-4 col-6 ms-auto">
                                        <button type="submit" id="replyBtn" class="form-control" sec:authorize="isAuthenticated()">등록</button>
                                        <button type="button" id="replyBtn" class="form-control" sec:authorize="isAnonymous()" disabled>로그인이 필요합니다 <a th:href="@{/loginPage}">login</a></button>
                                    </div>
                                    <input type="hidden" name="groupId" th:value="${blogWrite.writeId}">
                                </form>
                	</div>
            	</div>
            </section>
		</main>
<!----------------------------------- 댓글 끝 -------------------------------->
	</section>
	<!-- Blog Details Section End -->
	
	<!-- Related Blog Section Begin -->
	<section class="related-blog spad">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="section-title related-blog-title">
						<h2>Post You May Like</h2>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-4 col-md-4 col-sm-6">
					<div class="blog__item">
						<div class="blog__item__pic">
							<img th:src="@{/shoptemplate/img/blog/blog-1.jpg}" alt="">
						</div>
						<div class="blog__item__text">
							<ul>
								<li><i class="fa fa-calendar-o"></i> May 4,2019</li>
								<li><i class="fa fa-comment-o"></i> 5</li>
							</ul>
							<h5>
								<a href="#">Cooking tips make cooking simple</a>
							</h5>
							<p>Sed quia non numquam modi tempora indunt ut labore et
								dolore magnam aliquam quaerat</p>
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-6">
					<div class="blog__item">
						<div class="blog__item__pic">
							<img th:src="@{/shoptemplate/img/blog/blog-2.jpg}" alt="">
						</div>
						<div class="blog__item__text">
							<ul>
								<li><i class="fa fa-calendar-o"></i> May 4,2019</li>
								<li><i class="fa fa-comment-o"></i> 5</li>
							</ul>
							<h5>
								<a href="#">6 ways to prepare breakfast for 30</a>
							</h5>
							<p>Sed quia non numquam modi tempora indunt ut labore et
								dolore magnam aliquam quaerat</p>
						</div>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-6">
					<div class="blog__item">
						<div class="blog__item__pic">
							<img th:src="@{/shoptemplate/img/blog/blog-3.jpg}" alt="">
						</div>
						<div class="blog__item__text">
							<ul>
								<li><i class="fa fa-calendar-o"></i> May 4,2019</li>
								<li><i class="fa fa-comment-o"></i> 5</li>
							</ul>
							<h5>
								<a href="#">Visit the clean farm in the US</a>
							</h5>
							<p>Sed quia non numquam modi tempora indunt ut labore et
								dolore magnam aliquam quaerat</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		
		<!-- 댓글신고모달창 -->
	<div class="modal hidden">
		<div class="modal__background"></div>
		<div class="modal__content">
			<h3>신고하기</h3>
			<div class="modalText">
				<p>사유선택</p>
				<input type="checkbox" name="reason" id="ban1"
					th:onclick="checkOnlyone(this)" value="욕설 및 비하 발언">욕설 및 비하 발언<span id="1"></span><br> 
				<input type="checkbox" value="저작권,명예훼손 등 기타 권리 침해" id="ban2" name="reason"
					th:onclick="checkOnlyone(this)">저작권,명예훼손 등 기타 권리 침해<span id="2"></span><br> 
				<input type="checkbox" value="불건전한 글 등록" name="reason"
					id="ban3" th:onclick="checkOnlyone(this)"> 불건전한 글 등록 <span id="3"></span><br>
				<input type="checkbox" value="광고,홍보성 내용" name="reason"
					id="ban4" th:onclick="checkOnlyone(this)"> 광고,홍보성 내용 <span id="4"></span><br> 
				<input type="checkbox" value="기타" name="reason" id="ban5" th:onclick="checkOnlyone(this)"> 기타 <span id="5"></span><br>

				<button th:onclick="banSubmit()">신고하기</button>
				<button class="closeBtn">닫기</button>
			</div>
		</div>
	</div>
		
	</section>
	<!-- Related Blog Section End -->
	<!-- JS -->
	<th:block layout:fragment="script">
		<script th:src="@{/shoptemplate/js/jquery.nice-select.min.js}"></script>
		<script th:src="@{/shoptemplate/js/jquery-ui.min.js}"></script>
		<script th:src="@{/shoptemplate/js/jquery.slicknav.js}"></script>
		<script th:src="@{/shoptemplate/js/mixitup.min.js}"></script>
		<script th:src="@{/shoptemplate/js/owl.carousel.min.js}"></script>
		<script th:src="@{/shoptemplate/js/main.js}"></script>
	</th:block>
	
	<!-- 좋아요버튼 / 디비 저장해야함 -->
	<script type="text/javascript">
	
		let likeTF = $('.blogLike').val(); // input hidden value값으로 likeCount(like 테이블에 값이 있는지 조회)를 주고, 그 value를 가져옴
		let contentId='';
		let writerId='';
		
		var timeline1 = gsap.timeline({ repeatDelay: 0.7, paused: true}); //하트 효과
		timeline1.to(".heartbutton", {duration: 0.7, width: 50, ease: Back.easeIn}) 
	  			 .to(".like", {duration: 0.2, opacity: 0}, "-=0.7")
				 .to(".number", {duration: 0.2,opacity: 0, fontSize: 0}, "-=0.7")
				 .to(".far", {duration: 0.4, display: "none"}, "-=0.5") 
				 .to(".fa", {duration: 0.1, display: "inline-block"},"-=0.1")
				 .to(".heartbutton", {duration: 0.7, width: 170})
				 .to(".like", { opacity: 1},"-=0.5")
				 .to(".d", {duration: 0.3, opacity: 1, translateX: 0},"-=0.2").to(".number", {duration: 0.2, opacity: 1,text: "[[${cntBlogLike.count}]]", fontSize: 25}, "-=0.1");
		
		if(likeTF == 'Y'){ // like 테이블에 값이 있는지 확인하고, 값이 있으면 하트가 눌러진 상태로 표시 되게.
			timeline("[[${cntBlogLike.count}]]",true);
		}
		
		function timeline(e,tf){
			if(tf){ //만약 true이면,
				timeline1.to(".number", {duration: 0.2, opacity: 1,text: e, fontSize: 25}, "-=0.1"); //
				timeline1.play(); // 버튼 눌림
			}else{
				timeline1.progress(0).pause(); // 버튼 초기화
				$('.number').text(e);
			}
		}
		
		$(".heartbutton").click(function(){
			likeTF = $('.wrapper').find('input').val();
			event.stopPropagation();
			// 좋아요 디비 저장
			let bno = "[[${blogWrite.writeId}]]";
			let id = "[[${#authentication.principal.memberId}]]";
			
			if(id!=""){ // 로그인 된 상태이면
				//console.log($(".blogLike").val());
			  	if(likeTF=='F'){ // 테이블에 조회된 값이 없으면 db에 저장
			  			//db에 저장하는 메서드 컨트롤러에 추가
			  	
			  			$.ajax({
						      url: '/blog/addBlogLike',
						      method: 'post',
						      contentType: 'application/x-www-form-urlencoded',
						      data: {"groupId": bno}, // 컨트롤러로 넘겨줄 값. 이 페이지의 글 번호
						      success: function (result) {
						         console.log(result.count);
						         // Y를 F로
						         
						       $('.blogLike').val('Y'); // blogLike인 클래스의 값을 불러와서 'Y'로 바꿔준다
						       timeline(result.count,true);
						      },
						      error: function (error) {
						         console.log(error);
						      }
						   })
			  	
			  	
			  	}else{	// db에 삭제
			  			//db에서 삭제 또는 수정하는 메서드 컨트롤러에 추가
			  	
			  			$.ajax({
						      url: '/blog/delBlogLike',
						      method: 'post',
						      contentType: 'application/x-www-form-urlencoded',
						      data: {"groupId": bno},
						      success: function (result) {
						         console.log(result.count);
						         
						         // F를 Y로
						         $('.blogLike').val('F'); // blogLike인 클래스의 값을 불러와서 'F'로 바꿔준다
						         timeline(result.count,false);
						      },
						      error: function (error) {
						         console.log(error);
						      }
						   })
			  	};
			}else{ // 로그인 하지 않은 상태이면
				alert('로그인이 필요합니다');
			}
			});
				// 	좋아요 끝
			
				
				
				
				
				// 댓글 등록
			$('#replyBtn').on("click", function(){
				let bno = "[[${blogWrite.writeId}]]";
				let id = "[[${#authentication.principal.memberId}]]";
				if(id!=null){ // 로그인 된 상태이면
					$.ajax({
						url: '/blog/myblog/blogWrite/replyInsert',
						method: 'post',
						contentType: 'application/x-www-form-urlencoded',
						data: $('form[name="replyFrm"]').serialize(),
						success: function (result) {
					         console.log(result);
					         location.href='/blog/myblog/blogWrite?bno='+bno;	// 이거 빼고 어디에 뭐 넣어라~ 이런식으로
					    	 
						},
					      error: function (error) {
					         console.log(error);
					      }
					});
				}else{
					alert('로그인이 필요합니다.');
				}
			});
			
				
			//신고모달창 생성
			const openButton = document.querySelector(".openBtn");
			const modal = document.querySelector(".modal");
			const closeButton = modal.querySelector(".closeBtn");
			const modalBackground = modal.querySelector(".modal__background");

			function displayModal(){
				console.log("클릭")
			    modal.classList.toggle("hidden");
			}

			document.querySelectorAll(".openBtn").forEach((openButton) => {
		           console.log(openButton);
		           openButton.addEventListener("click", displayModal);
		         });
			closeButton.addEventListener("click", displayModal)
			modalBackground.addEventListener("click", displayModal);
		
			
			//신고체크박스시 자세내용적기 창 생성
			function checkOnlyone(element){
				const reason=document.getElementsByName("reason");
				reason.forEach((cb) => 
				{cb.checked = false;	
				let span=cb.nextElementSibling;
				span.innerHTML="";	
				})						
				element.checked = true;
				let span=element.nextElementSibling;
				span.innerHTML="<br><textarea name='text' placeholder='상세설명' id='detailReason'></textarea>";										
			}
			
			//신고제출
			function banSubmit(){
				console.log(contentId,writerId);
				let reasonLength = document.getElementsByName("reason").length;  
   				for (var i=0; i<reasonLength; i++) {
        			if (document.getElementsByName("reason")[i].checked == true) {
            			console.log(document.getElementsByName("reason")[i].value); 
            			var reason=document.getElementsByName("reason")[i].value
        			}
				}
   				
   				
   				console.log(document.getElementById("detailReason").value);
   				let detailReason=document.getElementById("detailReason").value; //상세 이유
   				let fromId="[[${#authentication.principal.memberId}]]"; //신고 한 사람
				//console.log(fromId, groupId,toId, reason);
				
					$.ajax({
						url: '/blog/addBan',
						method: 'post',
						contentType: 'application/x-www-form-urlencoded',
						data: {"groupId":contentId,
							   "toId":writerId,
							   "reason":reason,
							   "detailReason":detailReason},
						success: function (result) {
					         console.log(result);
					    	 alert("신고 완료");
					    	 
						},
					      error: function (error) {
					         console.log(error);
					      }
					})
					
			}
			
			// 그룹 아이디랑 신고받을 사람 아이디 받는 함수
				$('.openBtn').on("click",function(){
					contentId = $(this).attr('value1');
					writerId = $(this).attr('value2');
					console.log(contentId);
					console.log(writerId);
					banSubmit(contentId,writerId);
				})
			
			
			
			
	</script>
	
</div>

</html>