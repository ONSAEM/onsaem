<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<meta name="description" content="Ogani Template">
<meta name="keywords" content="Ogani, unica, creative, html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Ogani | Template</title>

<!-- Css  -->
<th:block layout:fragment="css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/font-awesome.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/elegant-icons.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/nice-select.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/shop/css/jquery-ui.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/owl.carousel.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/slicknav.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/style.css}"
		type="text/css">
</th:block>

<style>
/* 모먼트 */
@import
	url("https://fonts.googleapis.com/css?family=Cardo:400i|Rubik:400,700&display=swap")
	;

:root { 
	-d: 700ms; 
	-e: cubic-bezier(0.19, 1, 0.22, 1); 
	-font-sans: "Rubik", sans-serif; 
	-font-serif: "Cardo", serif;
}

* {
	box-sizing: border-box;
}

.mmtpage-content {
	display: grid;
	grid-gap: 1rem;
	padding: 1rem;
	max-width: 1024px;
	margin: 0 auto;
	font-family: var(- -font-sans);
}

@media ( min-width : 600px) {
	.mmtpage-content {
		grid-template-columns: repeat(2, 1fr);
	}
}

@media ( min-width : 800px) {
	.mmtpage-content {
		grid-template-columns: repeat(4, 1fr);
	}
}

.mmtcard {
	position: relative;
	display: flex;
	align-items: flex-end;
	overflow: hidden;
	padding: 1rem;
	width: 100%;
	text-align: center;
	color: whitesmoke;
	background-color: whitesmoke;
	box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1), 0 2px 2px rgba(0, 0, 0, 0.1),
		0 4px 4px rgba(0, 0, 0, 0.1), 0 8px 8px rgba(0, 0, 0, 0.1), 0 16px
		16px rgba(0, 0, 0, 0.1);
}

@media ( min-width : 600px) {
	.mmtcard {
		height: 350px;
		background-repeat: no-repeat;
		background-size: cover;
	}
}

.mmtcard:before {
	content: "";
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 110%;
	background-size: cover;
	background-position: 0 0;
	transition: transform calc(var(- -d)* 1.5) var(- -e);
	pointer-events: none;
}

.mmtcard:after {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 200%;
	pointer-events: none;
	background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%,
		rgba(0, 0, 0, 0.009) 11.7%, rgba(0, 0, 0, 0.034) 22.1%,
		rgba(0, 0, 0, 0.072) 31.2%, rgba(0, 0, 0, 0.123) 39.4%,
		rgba(0, 0, 0, 0.182) 46.6%, rgba(0, 0, 0, 0.249) 53.1%,
		rgba(0, 0, 0, 0.32) 58.9%, rgba(0, 0, 0, 0.394) 64.3%,
		rgba(0, 0, 0, 0.468) 69.3%, rgba(0, 0, 0, 0.54) 74.1%,
		rgba(0, 0, 0, 0.607) 78.8%, rgba(0, 0, 0, 0.668) 83.6%,
		rgba(0, 0, 0, 0.721) 88.7%, rgba(0, 0, 0, 0.762) 94.1%,
		rgba(0, 0, 0, 0.79) 100%);
	transform: translateY(-50%);
	transition: transform calc(var(- -d)* 2) var(- -e);
}

.mmtcard:before {
	/*   background-image: url(https://images.unsplash.com/photo-1517021897933-0e0319cfbc28?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=400&fit=max&ixid=eyJhcHBfaWQiOjE0NTg5fQ); */
	
}

.mmtcontent {
	position: relative;
	display: flex;
	flex-direction: column;
	align-items: center;
	width: 100%;
	padding: 1rem;
	transition: transform var(- -d) var(- -e);
	z-index: 1;
}

.mmtcontent>*+* {
	margin-top: 1rem;
}

.mmttitle {
	font-size: 1.3rem;
	font-weight: bold;
	line-height: 1.2;
}

.mmtcopy {
	font-family: var(- -font-serif);
	font-size: 1.125rem;
	font-style: italic;
	line-height: 1.35;
}

.mmtbtn {
	cursor: pointer;
	margin-top: 1.5rem;
	padding: 0.75rem 1.5rem;
	font-size: 0.65rem;
	font-weight: bold;
	letter-spacing: 0.025rem;
	text-transform: uppercase;
	color: white;
	background-color: black;
	border: none;
}

.mmtbtn:hover {
	background-color: #0d0d0d;
}

.mmtbtn:focus {
	outline: 1px dashed yellow;
	outline-offset: 3px;
}

@media ( hover : hover) and (min-width: 600px) {
	.mmtcard:after {
		transform: translateY(0);
	}
	.mmtcontent {
		transform: translateY(calc(100% - 4.5rem));
	}
	.mmtcontent>*:not(.mmttitle) {
		opacity: 0;
		transform: translateY(1rem);
		transition: transform var(- -d) var(- -e), opacity var(- -d) var(- -e);
	}
	.mmtcard:hover, .mmtcard:focus-within {
		align-items: center;
	}
	.mmtcard:hover:before, .mmtcard:focus-within:before {
		transform: translateY(-4%);
	}
	.mmtcard:hover:after, .mmtcard:focus-within:after {
		transform: translateY(-50%);
	}
	.mmtcard:hover .mmtcontent, .mmtcard:focus-within .mmtcontent {
		transform: translateY(0);
	}
	.mmtcard:hover .mmtcontent>*:not(.mmttitle), .mmtcard:focus-within .mmtcontent>*:not(.mmttitle)
		{
		opacity: 1;
		transform: translateY(0);
		transition-delay: calc(var(- -d)/8);
	}
	.mmtcard:focus-within:before, .mmtcard:focus-within:after, .mmtcard:focus-within .mmtcontent,
		.mmtcard:focus-within .mmtcontent>*:not(.mmttitle) {
		transition-duration: 0s;
	}
}

/* 프로필카드 */
@import url(https://fonts.googleapis.com/css?family=Roboto:300,400,600);
.snip1336 {
  font-family: 'Roboto', Arial, sans-serif;
  position: relative;
  overflow: hidden;
  margin: 10px;
  min-width: 230px;
  max-width: 315px;
  width: 100%;
  color: #ffffff;
  text-align: left;
  line-height: 1.4em;
  background-color: #141414;
}
.snip1336 * {
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  -webkit-transition: all 0.25s ease;
  transition: all 0.25s ease;
}
.snip1336 img {
  max-width: 100%;
  vertical-align: top;
  opacity: 0.85;
}
.snip1336 figcaption {
  width: 100%;
  background-color: #141414;
  padding: 25px;
  position: relative;
}
.snip1336 figcaption:before {
  position: absolute;
  content: '';
  bottom: 100%;
  left: 0;
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 55px 0 0 400px;
  border-color: transparent transparent transparent #141414;
}
.snip1336 figcaption a {
  padding: 5px;
  border: 1px solid #ffffff;
  color: #ffffff;
  font-size: 0.7em;
  text-transform: uppercase;
  margin: 10px 0;
  display: inline-block;
  opacity: 0.65;
  width: 47%;
  text-align: center;
  text-decoration: none;
  font-weight: 600;
  letter-spacing: 1px;
}
.snip1336 figcaption a:hover {
  opacity: 1;
}
.snip1336 .profile {
  border-radius: 50%;
  position: absolute;
  bottom: 100%;
  left: 25px;
  z-index: 1;
  max-width: 90px;
  opacity: 1;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
}
.snip1336 .follow {
  margin-right: 4%;
  border-color: #2980b9;
  color: #2980b9;
}
.snip1336 h2 {
  margin: 0 0 5px;
  font-weight: 300;
  color: white;
}
.snip1336 h2 span {
  display: block;
  font-size: 0.5em;
  color: #2980b9;
}
.snip1336 p {
  margin: 0 0 10px;
  font-size: 0.8em;
  letter-spacing: 1px;
  opacity: 0.8;
}
</style>
</head>
<body>
	<!-- Content -->

	<div layout:fragment="content">

		<!-- Breadcrumb Section Begin -->
		<section class="breadcrumb-section set-bg"
			th:data-setbg="@{/shoptemplate/img/breadcrumb.jpg}">
			<div class="container">
				<div class="row">
					<div class="col-lg-12 text-center">
						<div class="breadcrumb__text">
							<h2>Blog</h2>
							<div class="breadcrumb__option">
								<a href="./index.html">Home</a> <span>Blog</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!-- Breadcrumb Section End -->
		<!--  모먼트 -->
		<div class="blog__sidebar">
			<div class="blog__sidebar__item">
				<h3 style="text-align: center; margin: 0 auto;">
					MOMENT
					<a data-bs-toggle="modal" data-bs-target="#insertModal"
				type="button">▶</a>
				</h3>
			</div>
		</div>

		<main class="mmtpage-content">

			<!-- 모달창 띄우는 버튼 -->
			<a data-bs-toggle="modal" data-bs-target="#exampleModal"
				type="button" th:each="moment : ${moments}" id="modalBtn">
					<input type="hidden" id="mmtId" th:value="${moment.momentId}">
<!-- 					<div class="mmtcard" th:style="'background-image:url('+ @{${moment.fileRoute}} + @{${moment.mediaName}} + ');'"> -->

						<div class="mmtcard inputfield" id="preview-image"
						th:style="'background: url('+@{'/fileView/'+${moment.fileRoute}}+');background-repeat:no-repeat;'">
						
						<div class="mmtcontent">
							<h2 class="mmttitle">@[[${moment.blogId}]]</h2>
							<p class="mmtcopy">[[${moment.momentWrite}]]</p>
							<button class="mmtbtn">more</button>
						</div>
					</div>
			</a>
			

		</main>
		<!-- 모먼트 끝 -->
		<!-- Blog Section Begin -->
		<section class="blog spad">
			<div class="container">
				<div class="row">
					<div class="col-lg-4 col-md-5">
						<div class="blog__sidebar">
						
							<!-- 프로필 카드 -->
								<figure class="snip1336"><img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/331810/sample69.jpg" alt="sample69" />
								  <figcaption>
								    <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/331810/profile-sample5.jpg" alt="profile-sample5" class="profile" />
								    <h2>[[${blogInfo.nickname}]]<span>@[[${blogInfo.blogId}]]</span></h2>
								    <p>[[${blogInfo.introduction}]]</p>
								    <a href="#" class="follow">구독</a>
								    <a th:href="@{/blog/myblog/blogTask(blogId=${blogInfo.blogId})}" class="info">블로그 관리 ⚙</a> <!-- 로그인한 아이디와 블로그 주인이 같으면 보이게 -->
								  </figcaption>
								</figure>
							<!-- 프로필 카드 끝 -->
							
							<div class="blog__sidebar__search">
								<form method="post" action="/blog/myblog/searchWrite">
									<input type="text" placeholder="Search..." name="data">
									<input type="hidden" th:value="${param.userId}" id="blogId"
										name="blogId">
									<button type="submit"
										th:onclick="location.href='@{//blog/myblog/searchWrite/blogId/(blogId=${param.userId})}'">
										<span class="icon_search"></span>
									</button>
								</form>
							</div>
							<!--[[${param.userId}]]  유저 이름확인-->
							<div class="blog__sidebar__item">
								<a th:href="@{/blog/myblog/blogWrite/blogInsert}"
									class="blog__btn">글 작성<span class="arrow_right"></span></a>
								<h4>Categories</h4>
								<ul th:each="cate:${category}">
									<li><a href="#">[[${cate.categoryName}]]</a></li>
								</ul>
							</div>
							<div class="blog__sidebar__item">
								<h4>Recent News</h4>
								<div class="blog__sidebar__recent">
									<a href="#" class="blog__sidebar__recent__item"
										th:each="rW:${recentWrite}">
										<div class="blog__sidebar__recent__item__pic">
											<img th:src="@{/shoptemplate/img/blog/sidebar/sr-1.jpg}"
												alt="">
										</div>
										<div class="blog__sidebar__recent__item__text">
											<h6>
												[[${rW.writeTitle}]]<br /> -[[${rW.subTitle}]]
											</h6>
											<span>[[${#dates.format(rW.writeDate, 'YYYY-MM-DD')}]]</span>
										</div>
									</a>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-8 col-md-7">
						<div class="row">
							<div class="col-lg-6 col-md-6 col-sm-6"
								th:each="blog : ${myblog}">
								<div class="blog__item">
									<div class="blog__item__pic">
										<img th:src="@{/shoptemplate/img/blog/blog-2.jpg}" alt="">
									</div>
									<div class="blog__item__text">
										<ul>
											<li><i class="fa fa-calendar-o"
												th:text="${#dates.format(blog.writeDate, 'YYYY-MM-DD')}"></i></li>
											<li><i class="fa fa-comment-o"
												th:text="${blog.replyCnt}"></i></li>
										</ul>
										<h5>
											<a th:href="@{/blog/myblog/blogWrite(bno=${blog.writeId})}"
												th:text="${blog.writeTitle}"></a>
										</h5>
										<p th:text="${blog.subTitle}" />
										<a th:href="@{/blog/myblog/blogWrite(bno=${blog.writeId})}"
											class="blog__btn">READ MORE <span class="arrow_right"></span></a>
									</div>
								</div>
							</div>

							<div class="col-lg-12">
								<div class="product__pagination blog__pagination">
									<a href="#">1</a> <a href="#">2</a> <a href="#">3</a> <a
										href="#"><i class="fa fa-long-arrow-right"></i></a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!-- Blog Section End -->

		<!-- 모달창 조회 -->
		<div class="modal fade" id="exampleModal" tabindex="-1"
			aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-xl modal-dialog-scrollable">
				<div class="modal-content">

					<div class="modal-body row">
						<div class="col-md-6 modal-image sticky-top">
							<img id="modalImg" src="https://unsplash.it/800/1200.jpg?image=256"
								class="img-fluid sticky-top">
						</div>
						<div class="col-md-6 p-3">
							<span class="round"><img
										src="https://www.thispersondoesnotexist.com/image" alt="user"
										width="50"></span>
							<h3 class="mt-3" style="font-weight:bold"> 닉네임 </h3>

							<p id="nickname">Edited · 1d</p>
							<div class="mt-2 mx-2">
								<input type="text" class="form-control"
									placeholder="type comment" id="addUrl" readonly>
							</div>

							<div class="d-flex flex-row comment-row mt-2">
								<div class="p-2">
									
								</div>
								<div class="comment-text active w-100">
									<h5 id="mmtWrite">내용</h5>
								</div>
							</div>
							<p id="uploadDate"></p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 모달창 끝 -->
		
		<!-- 모먼트 작성 -->
		<div class="modal fade" id="insertModal" tabindex="-1"
			aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-xl modal-dialog-scrollable">
				<div class="modal-content">

					<div class="modal-body row">
						<div class="col-md-6 modal-image sticky-top">
							<h3>상세 내용</h3>
							<textarea id="momentWrite" cols="58" rows="20" placeholder="500자 미만으로 입력해주세요"></textarea>
						</div>
						<div class="col-md-6 p-3">
							
							<input type="text" class="form-control"
									placeholder="첨부할 주소를 입력하세요" id="insertUrl">
								<br>
							  <fieldset>
							  	<h3>업로드 기간</h3>
							    <input type="date" id="date" placeholder="Select a date" data-datepicker-events="{date: '2020-07-12T12:00', name: 'Business Lunch Zürich', type: 'holiday'}" required/>
							  	<br>
								<h3>공개범위</h3>
								<select name="publicScope" id="scope"> <!-- 공개범위 부분 나중에 value 수정 필요 -->
									<option value="public">전체공개</option>
									<option value="partial" selected>일부공개</option>
									<option value="private">비공개</option>
								</select>
								</fieldset>
							<div class="mt-2 mx-2">
							</div>

							<div class="d-flex flex-row comment-row mt-2">
								<form id="momentFrm">
								<div class="p-2">
									이미지 미리보기
									<div class="image-container">
									    <img style="width: 500px;" id="preview-image2" src="https://dummyimage.com/500x500/ffffff/000000.png&text=preview+image">
									    <input style="display: block;" type="file" name="uploadfile" multiple="multiple" id="input-image">
									</div>
								</div>
								</form>
							</div>
							<input type="hidden" id="getblogId" th:value="${blogInfo.blogId}">
							<button type="button" id="mmtInsertBtn"> 등록 </button>
						</div>
					</div>
				</div>
			</div>
		</div>	
		<!-- 모먼트 작성 끝 -->

		<!-- JS -->
		<th:block layout:fragment="script">
			<script th:src="@{/shoptemplate/js/jquery-3.3.1.min.js}"></script>
			<script th:src="@{/shoptemplate/js/bootstrap.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery.nice-select.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery-ui.min.js}"></script>
			<script th:src="@{/shoptemplate/js/jquery.slicknav.js}"></script>
			<script th:src="@{/shoptemplate/js/mixitup.min.js}"></script>
			<script th:src="@{/shoptemplate/js/owl.carousel.min.js}"></script>
			<script th:src="@{/shoptemplate/js/main.js}"></script>
		</th:block>

		<!-- moment -->
		<script type="text/javascript">
			// moment 모달
			
			//moment 등록버튼을 누르면, 입력된 값을 DB로 보내기
			$("#mmtInsertBtn").on("click", function(){
				let data = new FormData($('#momentFrm')[0]); //아이디가 momentFrm을 가져온다.
				
				data.append("momentWrite", $('#momentWrite').val());
				data.append("addUrl", $('#insertUrl').val());
				data.append("uploadEnd", $('#date').val());
				data.append("publicScope",$('#scope').val());  //컨트롤러에 가져갈 내용을 담는다.
				
				console.log(data.get("uploadfile"));
				
				$.ajax({
					url : '/blog/insertMoment',
					enctype: 'multipart/form-data',
					method : 'POST',
					processData: false,
					contentType: false,
					data : data,
					dataType:'json',
					success : function(result) {
						alert('성공');
						location.href='/blog/myblog?userId='+'[(${#authentication.principal.memberId})]';
					},
					error : function(error) {
						console.log(error);
						alert('실패');
					}
				})
			})
			
			// moment 모달 상세보기 모먼트번호 보내기
			$(".mmtpage-content").children("#modalBtn").each(function(){ 
				$(this).on("click", function(){
					console.log(this);
					let mno = $(this).children('#mmtId').val();
					console.log(mno);
	 				$.ajax({
	 					url: '/blog/getMoment',
	 					method: 'post',
	 					contentType: 'application/x-www-form-urlencoded',
	 					data: {"momentId": mno},
	 					success: function(result){
	 						console.log(result);
 	 						$(".mt-3").text(result.nickname);
 	 						$("#modalImg").attr("src", "/fileView/"+result.fileRoute);
 	 						$("#addUrl").attr("placeholder",result.addUrl);
 	 						$("#mmtWrite").text(result.momentWrite);
							$("#nickname").text("@"+result.blogId+" · "+result.writeDate.substr(0,10)+" "+result.writeDate.substr(11,5));
							$("#uploadDate").text(result.uploadStart.substr(0,10)+" - "+result.uploadEnd.substr(0,10));
	 					},
	 					error: function (error){
	 						console.log(error);
	 					}
	 				})
				})
				
				
			})
			
			
			
			// input file에 change 이벤트 부여
			const inputImage = document.getElementById("input-image")
			inputImage.addEventListener("change", function(e) {
				console.log('확인');
			    readImage(e.target);
			})
			//이미지 미리보기
			function readImage(input) {
			    // 인풋 태그에 파일이 있는 경우
			    if(input.files && input.files[0]) {
			        // 이미지 파일인지 검사 (생략)
			        // FileReader 인스턴스 생성
			        const reader = new FileReader();
			        // 이미지가 로드가 된 경우
			        // reader가 이미지 읽도록 하기
			        reader.readAsDataURL(input.files[0]);
			        reader.onload = e => {
			            const previewImage = document.getElementById("preview-image2");
			            console.log('확인22');
			            previewImage.src = e.target.result;
			            console.log(previewImage.src);
			        }
			        
			    }
			}
			
			//
			
		</script>
	</div>
</body>
</html>