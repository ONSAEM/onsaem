<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<title>shop main</title>

<!-- Google Font -->
<head>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />

</head>


<!-- Css  -->
<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/bootstrap.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/elegant-icons.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/nice-select.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/jquery-ui.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/owl.carousel.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/slicknav.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/style.css}"
		type="text/css">
</th:block>


<!-- Content -->
<div layout:fragment="content">
	<!-- Breadcrumb Section Begin -->
	<section class="breadcrumb-section set-bg"
		th:data-setbg="@{/shoptemplate/img/breadcrumb.jpg}">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 text-center">
					<div class="breadcrumb__text">
						<h2>Onsaem Shop</h2>
						<div class="breadcrumb__option">
							<a href="./index.html">Home</a> <span>Shop</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- Breadcrumb Section End -->
	<br>
	<!-- Hero Section Begin -->
	<section class="hero hero-normal">
		<div class="container">
			<div class="row">
				<div class="col-lg-3">
					<div class="hero__categories">
						<div class="hero__categories__all">
							<i class="fa fa-bars"></i> <span style="text-align: center">ì¹´í…Œê³ ë¦¬</span>
						</div>
						<ul>
							<li><a href="/shop">ì „ì²´</a></li>
							<li th:each="category:${categoryList}"><a
								th:href="@{/category/(data=${category.optionContent})}"
								th:text="${category.optionContent}"></a></li>

						</ul>
					</div>
				</div>
				<div class="col-lg-9">
					<div class="hero__search">
						<div class="hero__search__form">
							<form action="/searchProduct" method="post">
								<input type="hidden" id="token" th:name="${_csrf.parameterName}"
									th:value="${_csrf.token}" /> <input type="text"
									placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”." name="data">
								<button type="submit" class="site-btn">ğŸ¼</button>
							</form>
						</div>
						<div class="header__cart">
							<ul>
								<li><a href="/likeList"><i class="fa fa-heart"
										sec:authorize="isAuthenticated()"></i> <span
										th:text="${#lists.size(likeList)}"
										sec:authorize="isAuthenticated()">1</span></a></li>
								<li><a th:href="@{/shopCart}"><i
										class="fa fa-shopping-bag" sec:authorize="isAuthenticated()"></i>
										<span th:text="${#lists.size(cartList)}"
										sec:authorize="isAuthenticated()">3</span></a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- Hero Section End -->


	<!-- Product Section Begin -->
	<section class="product spad" style="padding: 0">
		<div class="container">
			<div class="row">
				<div class="col-lg-3 col-md-5">
					<div class="sidebar">
						<div class="sidebar__item">
							<div class="latest-product__text">
								<h4>ìµœê·¼ ë³¸ ìƒí’ˆ</h4>
								<div class="latest-product__slider owl-carousel" id="watchList">
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-9 col-md-7">
					<div class="sidebar__item__size" th:each="category:${categoryList}">
						<label for="large" th:text="${category.optionContent}"							t
							th:onclick="'location.href=\'' + @{/category/(data=${category.optionContent})} + '\''">
							Large <input type="radio" id="large">
						</label>
					</div>
					<br> <br>
					<div class="product__discount">
						<div class="section-title product__discount__title">
							<h2>ì£¼ê°„ ë² ìŠ¤íŠ¸</h2>
						</div>
						<div class="row">
							<div class="product__discount__slider owl-carousel" id="bestList">
								<div class="col-lg-4">
									<div class="product__discount__item">
										<div class="product__discount__item__pic set-bg"
											th:data-setbg="@{/shoptemplate/img/product/discount/pd-1.jpg}">
											<div class="product__discount__percent">-20%</div>
											<ul class="product__item__pic__hover">
												<li><a href="#"><i class="fa fa-heart"></i></a></li>
												<li><a href="#"><i class="fa fa-shopping-cart"></i></a></li>
											</ul>
										</div>
										<div class="product__discount__item__text">
											<span>Dried Fruit</span>
											<h5>
												<a href="#">Raisinâ€™nâ€™nuts</a>
											</h5>
											<div class="product__item__price">
												$30.00 <span>$36.00</span>
											</div>
										</div>
									</div>
								</div>
								<div class="col-lg-4">
									<div class="product__discount__item">
										<div class="product__discount__item__pic set-bg"
											th:data-setbg="@{/shoptemplate/img/product/discount/pd-5.jpg}">
											<div class="product__discount__percent">-20%</div>
											<ul class="product__item__pic__hover">
												<li><a href="#"><i class="fa fa-heart"></i></a></li>
												<li><a href="#"><i class="fa fa-retweet"></i></a></li>
												<li><a href="#"><i class="fa fa-shopping-cart"></i></a></li>
											</ul>
										</div>
										<div class="product__discount__item__text">
											<span>Dried Fruit</span>
											<h5>
												<a href="#">Raisinâ€™nâ€™nuts</a>
											</h5>
											<div class="product__item__price">
												$30.00 <span>$36.00</span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="filter__item">
						<div class="row">
							<div class="col-lg-4 col-md-5">
								<div class="filter__sort">
									<span>Sort By</span> <select id="changeList"
										th:onchange="changeList(this.value)">
										<option value="new"
											th:selected="${#strings.equals(param.data, 'new')}">ìµœì‹ ìˆœ</option>
										<option value="popularity"
											th:selected="${#strings.equals(param.data, 'popularity')}">ì¸ê¸°ìˆœ</option>
									</select>
								</div>
							</div>
							<div class="col-lg-4 col-md-4">
								<div class="filter__found">
									<h6>
										<span th:text="${#lists.size(productList)}"></span> Products
										found
									</h6>
								</div>
							</div>
							<div class="col-lg-4 col-md-3">
								<div class="filter__option">
									<span class="icon_grid-2x2"></span> <span class="icon_ul"></span>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-lg-4 col-md-6 col-sm-6"
							th:each="product:${productList}">
							<div class="product__item">
								<div class="product__item__pic set-bg"
									th:data-setbg="@{/fileView/{fileRoute}/
									(fileRoute=${product.fileRoute})}"
									th:onclick="productDetail([[${product.productId}]])">
									<ul class="product__item__pic__hover"
										sec:authorize="isAuthenticated()">
										<li><a th:href="@{/likeAdd(data=${product.productId})}"
											th:onclick="likeEvent()"><i class="fa fa-heart"></i></a></li>
										<li><a
											th:href="@{/cartAdd(productId=${product.productId})}"
											th:onclick="cartEvent()"><i class="fa fa-shopping-cart"></i></a></li>
									</ul>
									<ul class="product__item__pic__hover"
										sec:authorize="isAnonymous()">
										<li><a href="/loginPage" th:onclick="noLogin()"><i
												class="fa fa-heart"></i></a></li>
										<li><a href="/loginPage" th:onclick="noLogin()"><i
												class="fa fa-shopping-cart"></i></a></li>
									</ul>
								</div>
								<div class="product__item__text">
									<h6>
										<a th:onclick="productDetail([[${product.productId}]])"
											th:text=${product.productName}>Crab Pool Security</a>
									</h6>
									<h5 th:text="${product.price}+ì›">$30.00</h5>
								</div>
							</div>
						</div>
					</div>
					<!-- í˜ì´ì§• -->
					<th:block
						th:replace="fragments/paging :: component(${paging}, 'gopage')">
				</div>
			</div>
			<input type="hidden" value="${session.id}" id="id">
		</div>
	</section>
	<!-- Product Section End -->



	<!-- JS -->
	<th:block layout:fragment="script">
		<script th:src="@{/shoptemplate/js/jquery-3.3.1.min.js}"></script>
		<script th:src="@{/shoptemplate/js/bootstrap.min.js}"></script>
		<script th:src="@{/shoptemplate/js/jquery.nice-select.min.js}"></script>
		<script th:src="@{/shoptemplate/js/jquery-ui.min.js}"></script>
		<script th:src="@{/shoptemplate/js/jquery.slicknav.js}"></script>
		<script th:src="@{/shoptemplate/js/mixitup.min.js}"></script>
		<script th:src="@{/shoptemplate/js/owl.carousel.min.js}"></script>
		<script th:src="@{/shoptemplate/js/main.js}"></script>

		<script type="text/javascript">
		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");
		 
		//ë¡œê·¸ì¸ ì•ˆí–ˆì„ë•Œ í•¨ìˆ˜ì‹¤í–‰
		function noLogin(){
			alert("ë¡œê·¸ì¸ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.")					
		}
		
		 window.onload = function() {
			 function gopage(i){
					console.log(i);
					location.href='/shop?page='+i;
				}
			 
				//ì£¼ê°„ë² ìŠ¤íŠ¸ ëª©ë¡
				$.ajax({
					type : 'get',
					url : '/shop/weekBest',
					headers : {
						"Content-Type" : "application/json"
					},
					success : function(result) {						
							$.ajax({
							type : 'post',
							url : '/shop/weekBestProduct',
							beforeSend : function(xhr)
				               {   /*ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì •í•œë‹¤*/
					               xhr.setRequestHeader(header, token);
					               },
							headers : {
								"Content-Type" : "application/json"
							},
							data:JSON.stringify(result),
							success : function(result) {								
								$("#bestList").html("")
								for(let i=0;i<result.length;i++){
									let list=`<div class="col-lg-4">
									<div class="product__discount__item">
									<div class="product__discount__item__pic"											
										style="background-image:url('/fileView/${result[i].fileRoute}');  width: 300px;
											  height: 150px;
									  object-fit: cover; ">												
											<ul class="product__item__pic__hover">											
												<li><a href="#"><i class="fa fa-heart"></i></a></li>												
												<li><a href="#"><i class="fa fa-shopping-cart"></i></a></li>
											</ul>
										</div>
										<div class="product__discount__item__text">	<h5>
												<a href="#">`+result[i].productName+`</a>
											</h5>
											<div class="product__item__price">
												`+result[i].price+`
											</div>
										</div>
									</div>
								</div>`;
								$("#bestList").append(list)
							   
								}
							},
							error : function(error) {
								console.log(error)
							}
						})
					},
					error : function(error) {
						console.log(error)
					}
				}) 
				
				
				//ìµœê·¼ë³¸ìƒí’ˆ ì„¸ì…˜ ì „ë‹¬
				let watch = sessionStorage.getItem('productId').split(',');
				let data5 = watch[watch.length-2];
				let data4 = watch[watch.length - 3];
				let data3 = watch[watch.length - 4];
				let data2 = watch[watch.length - 5];
				let data1 = watch[watch.length - 6];
				 $.ajax({
					type : 'post',
					url : '/watchProduct',
					headers : {
						"Content-Type" : "application/json"
					},
					beforeSend : function(xhr)
		               {   /*ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì •í•œë‹¤*/
		               xhr.setRequestHeader(header, token);
		               },
					data : JSON.stringify({
						"session1" : data1,
						"session2" : data2,
						"session3" : data3,
						"session4" : data4,
						"session5" : data5
					}),
					success : function(result) {
						console.log(result)
						$("#watchList").html("");
						for(let i=0; i<result.length;i++){
							let watchList=`<div class="latest-prdouct__slider__item">
								<a href="/shopDetail?data=`+result[i].productId+`" class="latest-product__item">
								<div class="latest-product__item__pic">
									<img src="/fileView/`+result[i].fileRoute+`"
										alt="">
								</div>
								<div class="latest-product__item__text">
									<h6>`+result[i].productName+`</h6>
									<span>`+result[i].price+`</span>
								</div>
							</a>
						</div>`;	
						$("#watchList").prepend(watchList);
						}
						
					},
					error : function(error) {
						console.log(error)
					}
				}) 
			}
		
			let id = '[[${session.id}]]';
			// ìƒí’ˆ ìƒíƒœë³„ ì¡°íšŒ
			function changeList(data) {
				console.log(data);
				if (data == 'new') {
					//ì‹ ìƒí’ˆìˆœìœ¼ë¡œ ëª©ë¡í‘œì‹œ
					location.href = "http://localhost/shop?data=" + data;
				} else {
					//ë³„ì ìˆœìœ¼ë¡œ ëª©ë¡í‘œì‹œ
					location.href = "http://localhost/shop?data=" + data;
				}
			}

			function likeEvent() {
				alert("ì°œëª©ë¡ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.")
			}

			function cartEvent() {
				alert("ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
			}

			//ìµœê·¼ë³¸ìƒí’ˆ ì„¸ì…˜ì €ì¥
			function productDetail(data) {
				if (sessionStorage.getItem('productId') != null) {
					let sessionProduct=sessionStorage.getItem('productId');
					sessionProduct=sessionProduct.replace(data+",",'');
					sessionStorage.setItem('productId', sessionProduct+ data + ",");
				} else {
					sessionStorage.setItem('productId', data + ",");
				}
				location.href = '/shopDetail?data=' + data
			}			
		</script>
	</th:block>


</div>
</html>