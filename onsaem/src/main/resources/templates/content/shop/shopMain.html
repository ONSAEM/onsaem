<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<title>shop main</title>

<!-- Google Font -->

<head>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
<style>
/* GENERAL STYLES */
.pagination ul {
	margin: auto;
	padding: 0;
	list-style: none;
}

/* ONE */
.p1 li {
	font-size: 14px;
	width: 40px;
	height: 40px;
	line-height: 40px;
	padding: 0;
	text-align: center;
	float: left;
	cursor: pointer;
}

.main {
	flex-grow: 1;
	display: flex;
	flex-direction: column;
	min-width: 1400px;
}

.main-container {
	padding: 20px;
	flex-grow: 1;
	overflow: auto;
	background-color: #FCFBFC;
}

.profile-cover {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	object-fit: cover;
	object-position: center;
	border-radius: 4px;
}

.subheader {
	position: relative;
	height: 300px;
	min-height: 250px;
	z-index: 1;
	display: flex;
	justify-content: center;
	align-items: center;
	background-size: cover;
	background-position: center;
}

.subheader:before {
	content: "";
	width: 100%;
	height: 100%;
	position: absolute;
	z-index: -1;
	left: 0;
	top: 0;
	background-image: url("/course/산.gif");
	background-repeat: no-repeat;
	background-size: cover;
	background-position: center;
	filter: blur(30px);
	opacity: 0.7;
}

.glass {
	height: 100%;
	width: 100%;
	background-image: url("/course/산.gif");
	background-size: cover;
	background-position: center;
	clip-path: inset(10em);
	filter: blur(5px);
	display: flex;
	justify-content: center;
	align-items: center;
}

.drop-shadow {
	height: 155%;
	width: 100%;
	filter: drop-shadow(0px 20px 10px rgba(0, 0, 0, 0.3));
	display: flex;
	justify-content: center;
	align-items: center;
}

.drop-shadow:before {
	display: block;
	content: "";
	position: absolute;
	top: 10em;
	height: calc(100% - 20em);
	width: calc(100% - 20em);
	border-top: 2px solid rgba(225, 225, 225, 0.2);
	border-left: 1px solid rgba(225, 225, 225, 0.1);
	border-right: 1px solid rgba(225, 225, 225, 0.3);
	z-index: 2;
}

.drop-shadow>span {
	position: absolute;
	z-index: 5;
	color: white;
	font-size: 4em;
	letter-spacing: 0.75em;
	padding-left: 0.375em;
}

.sidebar {
	padding: 20px 30px;
	background-color: #ffffff;
	border-radius: 10px;
	margin-bottom: 10px;
}

.col-lg-9 {
	background-color: #ffffff;
	padding: 20px 30px;
	border-radius: 20px;
	margin-bottom: 10px;
}

.product {
	padding-top: 0px;
	padding-bottom: 80px;
	position: relative;
	z-index: 1;
}

.gridView .products-row {
	margin: 8px;
	width: calc(100% - 16px);
	background-color: #f3f6fd;
	border-radius: 4px;
	cursor: pointer;
	transition: transform 0.2s;
	position: relative;
	padding-bottom: 8px;
}

.products-row img {
	border-radius: 4px 4px 0px 0px;
	height: 70%;
	width: 100%;
}

.product-cell {
	margin: 8px;
	text-align: end;
}

.classList .products-row {
	margin: 15px 26px;
	width: calc(30% - 16px);
	background-color: #f3f6fd;
	border-radius: 4px;
	cursor: pointer;
	transition: transform 0.2s;
	position: relative;
	padding-bottom: 8px;
	margin-bottom: 20px;
	height: 400px;
}

.classList {
	flex-shrink: 0;
	width: 100%;
	max-width: 100%;
	padding-right: calc(var(- -bs-gutter-x)* .5);
	padding-left: calc(var(- -bs-gutter-x)* .5);
	margin-top: var(- -bs-gutter-y);
	display: flex;
	flex-wrap: wrap;
}

.product__discount {
	margin-top: 104px;
}

#categoryList {
	margin-top: 18px;
}
</style>
</head>


<!-- Css  -->
<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/bootstrap.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/elegant-icons.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/nice-select.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/jquery-ui.min.css}"
		type="text/css">
	<link rel="stylesheet"
		th:href="@{/shoptemplate/css/owl.carousel.min.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/slicknav.min.css}"
		type="text/css">
	<link rel="stylesheet" th:href="@{/shoptemplate/css/style.css}"
		type="text/css">
</th:block>


<!-- Content -->
<div layout:fragment="content">
	<div class="main">
		<div class="main-container">
			<div class="subheader">
				<img src="/course/산.gif" alt="" class="profile-cover">
				<div class="drop-shadow">
					<div class="glass"></div>
					<span>SHOP</span>
				</div>
			</div>
			<!-- Breadcrumb Section End -->
			<br>
			<!-- Hero Section Begin -->
			<section class="hero hero-normal"
				style="position: relative; z-index: 2;">
				<div class="container">
					<div class="row">
						<div class="col-lg-3">
							<div class="hero__categories">
								<div class="hero__categories__all">
									<i class="fa fa-bars"></i> <span style="text-align: center;">카테고리</span>
								</div>
								<ul>
									<li><a href="/shop">전체</a></li>
									<li th:each="category:${categoryList}"><a
										th:href="@{/category/(data=${category.optionContent})}"
										th:text="${category.optionContent}"></a></li>

								</ul>
							</div>
						</div>
						<div class="col-lg-9">
							<div class="hero__search">
								<div class="hero__search__form">
									<form action="/searchProduct" method="post">
										<input type="hidden" id="token"
											th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
										<input type="text" placeholder="검색어를 입력해 주세요." name="data">
										<button type="submit" class="site-btn">search</button>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
			<!-- Hero Section End -->


			<!-- Product Section Begin -->
			<section class="product spad" style="padding: 0;">
				<div class="container">
					<div class="row">
						<div class="col-lg-3 col-md-5"
							style="position: relative; z-index: 1">
							<div class="sidebar">
								<div class="sidebar__item">
									<div class="latest-product__text">
										<h4>최근 본 상품</h4>
										<div class="latest-product__slider owl-carousel"
											id="watchList"></div>
									</div>
								</div>
							</div>
						</div>

						<br> <br>
						<div class="col-lg-9 col-md-7">
							<div id="categoryList">
								<div class="sidebar__item__size"
									th:each="category:${categoryList}">
									<label for="large" th:text="${category.optionContent}" t
										th:onclick="'location.href=\'' + @{/category/(data=${category.optionContent})} + '\''">
										Large <input type="radio" id="large">
									</label>
								</div>
							</div>
							<div class="product__discount">
								<div class="section-title product__discount__title">
									<h2 class="ko-h2">주간 베스트</h2>
								</div>
								<div class="row">
									<div class="product__discount__slider owl-carousel"
										id="bestList">
										<div class="col-lg-4" th:each="week:${weekList}">
											<div class="product__discount__item">
												<div class="product__discount__item__pic set-bg"
													th:data-setbg="@{/fileView/{fileRoute}/
									(fileRoute=${week.fileRoute})}"
													style="cursor: pointer"></div>
											</div>
											<div class="product__discount__item__text">
												<h5>
													<a th:onclick="productDetail([[${week.productId}]])"
														style="cursor: pointer">[[${week.productName}]]</a>
												</h5>
												<div class="product__item__price">[[${week.price}]]원</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div
							style="background-color: #ffffff; padding: 20px 30px; border-radius: 20px; margin-bottom: 10px;">
							<div class="filter__item">
								<div class="row">
									<div class="col-lg-4 col-md-5">
										<div class="filter__sort">
											<span>Sort By</span> <select id="changeList"
												th:onchange="changeList(this.value)">
												<option value="new"
													th:selected="${#strings.equals(param.data, 'new')}">최신순</option>
												<option value="popularity"
													th:selected="${#strings.equals(param.data, 'popularity')}">인기순</option>
											</select>
										</div>
									</div>
									<div class="col-lg-4 col-md-4">
										<div class="filter__found">
											<h6>
												<span th:text="${#lists.size(productList)}"></span> Products
												found
											</h6>
										</div>
									</div>
									<div class="col-lg-4 col-md-3">
										<div class="filter__option">
											<span class="icon_grid-2x2"></span> <span class="icon_ul"></span>
										</div>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-lg-4 col-md-6 col-sm-6"
									th:each="product:${productList}">
									<div class="product__item">
										<div class="product__item__pic set-bg"
											th:data-setbg="@{/fileView/{fileRoute}/
									(fileRoute=${product.fileRoute})}"
											th:onclick="productDetail([[${product.productId}]])"
											style="cursor: pointer">
											<ul class="product__item__pic__hover"
												sec:authorize="isAuthenticated()">
												<li><a th:href="@{/likeAdd(data=${product.productId})}"
													th:onclick="likeEvent()"><i class="fa fa-heart"></i></a></li>
												<li><a
													th:href="@{/cartAdd(productId=${product.productId})}"
													th:onclick="cartEvent()"><i class="fa fa-shopping-cart"></i></a></li>
											</ul>
											<ul class="product__item__pic__hover"
												sec:authorize="isAnonymous()">
												<li><a href="/loginPage" th:onclick="noLogin()"><i
														class="fa fa-heart"></i></a></li>
												<li><a href="/loginPage" th:onclick="noLogin()"><i
														class="fa fa-shopping-cart"></i></a></li>
											</ul>
										</div>
										<div class="product__item__text">
											<h6>
												<a th:onclick="productDetail([[${product.productId}]])"
													th:text=${product.productName} style="cursor: pointer">Crab
													Pool Security</a>
											</h6>
											<h5 th:text="${product.price}+원">$30.00</h5>
										</div>
									</div>
								</div>
							</div>
							<!-- 페이징 -->
							<th:block
								th:replace="fragments/paging :: component(${paging}, 'gopage')">
						</div>
					</div>
				</div>
				<input type="hidden" value="${session.id}" id="id">

			</section>
			<!-- Product Section End -->



			<!-- JS -->
			<th:block layout:fragment="script">
				<script th:src="@{/shoptemplate/js/jquery-3.3.1.min.js}"></script>
				<script th:src="@{/shoptemplate/js/bootstrap.min.js}"></script>
				<script th:src="@{/shoptemplate/js/jquery.nice-select.min.js}"></script>
				<script th:src="@{/shoptemplate/js/jquery-ui.min.js}"></script>
				<script th:src="@{/shoptemplate/js/jquery.slicknav.js}"></script>
				<script th:src="@{/shoptemplate/js/mixitup.min.js}"></script>
				<script th:src="@{/shoptemplate/js/owl.carousel.min.js}"></script>
				<script th:src="@{/shoptemplate/js/main.js}"></script>

				<script type="text/javascript">
		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");
		 
		//로그인 안했을때 함수실행
		function noLogin(){
			alert("로그인 후 사용 가능합니다.")					
		}
		
		 window.onload = function() {
			 function gopage(i){					
					location.href='/shop?page='+i;
				}				
				
				//최근본상품 세션 전달
				let watch = sessionStorage.getItem('productId').split(',');
				let data5 = watch[watch.length-2];
				let data4 = watch[watch.length - 3];
				let data3 = watch[watch.length - 4];
				let data2 = watch[watch.length - 5];
				let data1 = watch[watch.length - 6];
				 $.ajax({
					type : 'post',
					url : '/watchProduct',
					headers : {
						"Content-Type" : "application/json"
					},
					beforeSend : function(xhr)
		               {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
		               xhr.setRequestHeader(header, token);
		               },
					data : JSON.stringify({
						"session1" : data1,
						"session2" : data2,
						"session3" : data3,
						"session4" : data4,
						"session5" : data5
					}),
					success : function(result) {						
						$("#watchList").html("");
						for(let i=0; i<result.length;i++){
							let watchList=`<div class="latest-prdouct__slider__item">
								<a href="/shopDetail?data=`+result[i].productId+`" class="latest-product__item">
								<div class="latest-product__item__pic">
									<img src="/fileView/`+result[i].fileRoute+`"
										alt="">
								</div>
								<div class="latest-product__item__text">
									<h6>`+result[i].productName+`</h6>
									<span>`+result[i].price+`원</span>
								</div>
							</a>
						</div>`;	
						$("#watchList").prepend(watchList);
						}
						
					},
					error : function(error) {
						console.log(error)
					}
				}) 
			}
		
			let id = '[[${session.id}]]';
			// 상품 상태별 조회
			function changeList(data) {			
				if (data == 'new') {
					//신상품순으로 목록표시
					location.href = "/shop?data=" + data;
				} else {
					//별점순으로 목록표시
					location.href = "/shop?data=" + data;
				}
			}

			function likeEvent() {
				alert("찜목록에 추가되었습니다.")
			}

			function cartEvent() {
				alert("장바구니에 추가되었습니다.");
			}

			//최근본상품 세션저장
			function productDetail(data) {
				if (sessionStorage.getItem('productId') != null) {
					let sessionProduct=sessionStorage.getItem('productId');
					sessionProduct=sessionProduct.replace(data+",",'');
					sessionStorage.setItem('productId', sessionProduct+ data + ",");
				} else {
					sessionStorage.setItem('productId', data + ",");
				}
				location.href = '/shopDetail?data=' + data
			}			
		</script>
			</th:block>

		</div>
	</div>
</div>
</html>